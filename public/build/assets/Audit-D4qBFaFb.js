import{e as L,p as Y,c as a,a as w,u as i,h as N,w as A,b as e,f as H,o as l,F as x,r as m,t as d,q as v,B as C,n as $,C as U,z as M,d as g,g as z,k,j as R}from"./app-B2KrZOCa.js";import{_ as O}from"./AppLayout-CMhKAyAT.js";import"./ApplicationLogo-CBvPJGvQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-Dw9Qk6Ag.js";const G={class:"py-6"},P={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},K={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Q={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},X={class:"flex flex-wrap gap-2 mb-3"},J=["onClick"],W={class:"flex flex-wrap gap-2 mb-3"},Z=["onClick"],I=["onClick"],ee={class:"grid grid-cols-2 gap-4"},te={class:"space-y-2"},re=["value"],se={class:"ml-3 text-sm text-gray-700 dark:text-gray-300"},oe={class:"space-y-3"},ae={class:"flex items-center"},le={class:"flex items-center"},de={key:0,class:"rounded-lg bg-gray-50 dark:bg-gray-700 p-4"},ne={key:0,class:"flex items-center justify-center py-4"},ie={key:1,class:"text-sm text-red-600 dark:text-red-400"},ue={key:2,class:"space-y-2"},ce={class:"flex justify-between text-sm"},ge={class:"font-medium text-gray-900 dark:text-white"},xe={key:0,class:"flex justify-between text-sm"},me={class:"font-medium text-gray-900 dark:text-white"},ye={class:"flex justify-between text-sm pt-2 border-t border-gray-200 dark:border-gray-600"},pe={class:"font-medium text-gray-900 dark:text-white"},ve={class:"flex justify-between text-sm"},be={class:"font-medium text-gray-900 dark:text-white"},fe={class:"flex justify-between text-sm"},ke={class:"font-medium text-gray-900 dark:text-white"},_e={class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600"},he={key:0,class:"flex items-center text-sm text-green-600 dark:text-green-400"},we={key:1,class:"text-sm text-amber-600 dark:text-amber-400"},Ae={key:0,class:"mt-1 ml-5 list-disc text-xs"},Ce={key:0},$e={class:"flex justify-end"},Me=["disabled"],ze={key:0},Fe={key:1},Se={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},Te={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ve={key:1,class:"space-y-3"},je={class:"flex-1 min-w-0"},Ee={class:"flex items-center gap-2"},Be={class:"text-sm font-medium text-gray-900 dark:text-white"},qe={class:"mt-1 flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"},De={key:0},Le={key:0,class:"mt-1 text-xs text-amber-600 dark:text-amber-400"},Ye={class:"flex items-center gap-2 ml-4"},Ne=["onClick"],He=["onClick"],Ke={__name:"Audit",props:{exports:Array,years:Array,formats:Object,defaultYear:Number},setup(c){const _=c,s=L({period_start:`${_.defaultYear}-01-01`,period_end:`${_.defaultYear}-12-31`,format:"csv",include_credit_notes:!0,anonymize:!1}),n=k(null),b=k(!1),y=k(null),F=async()=>{b.value=!0,y.value=null;try{const o=await fetch(route("exports.audit.preview",{period_start:s.period_start,period_end:s.period_end,include_credit_notes:s.include_credit_notes}));if(!o.ok)throw new Error("Erreur lors du chargement de l'aperçu");n.value=await o.json()}catch(o){y.value=o.message,n.value=null}finally{b.value=!1}};Y([()=>s.period_start,()=>s.period_end,()=>s.include_credit_notes],()=>{s.period_start&&s.period_end&&F()},{immediate:!0});const S=o=>{s.period_start=`${o}-01-01`,s.period_end=`${o}-12-31`},T=(o,t)=>{const p=(t-1)*3+1,r=p+2,u=new Date(o,r,0).getDate();s.period_start=`${o}-${String(p).padStart(2,"0")}-01`,s.period_end=`${o}-${String(r).padStart(2,"0")}-${u}`},V=(o,t)=>{t===1?(s.period_start=`${o}-01-01`,s.period_end=`${o}-06-30`):(s.period_start=`${o}-07-01`,s.period_end=`${o}-12-31`)},f=o=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(o),j=o=>o?new Date(o).toLocaleString("fr-FR"):"-",E=()=>{s.post(route("exports.audit.store"))},B=o=>{window.location.href=route("exports.audit.download",o.id)},q=o=>{confirm("Supprimer cet export ?")&&R.delete(route("exports.audit.destroy",o.id))},h=o=>{switch(o){case"completed":return{class:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",text:"Terminé"};case"processing":return{class:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",text:"En cours"};case"failed":return{class:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",text:"Échec"};default:return{class:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",text:"En attente"}}};return(o,t)=>(l(),a(x,null,[w(i(N),{title:"Export Audit FAIA"}),w(O,null,{header:A(()=>[...t[5]||(t[5]=[e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Export Audit FAIA ",-1)])]),default:A(()=>{var p;return[e("div",G,[e("div",P,[e("div",K,[e("div",Q,[t[22]||(t[22]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," Nouvel export ",-1)),e("form",{onSubmit:H(E,["prevent"]),class:"space-y-6"},[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Période ",-1)),e("div",X,[(l(!0),a(x,null,m(c.years,r=>(l(),a("button",{key:r,type:"button",onClick:u=>S(r),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"},d(r),9,J))),128))]),e("div",W,[(l(),a(x,null,m([1,2,3,4],r=>e("button",{key:`q${r}`,type:"button",onClick:u=>T(c.defaultYear,r),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}," T"+d(r)+" "+d(c.defaultYear),9,Z)),64)),(l(),a(x,null,m([1,2],r=>e("button",{key:`s${r}`,type:"button",onClick:u=>V(c.defaultYear,r),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}," S"+d(r)+" "+d(c.defaultYear),9,I)),64))]),e("div",ee,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Du",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>i(s).period_start=r),type:"date",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[C,i(s).period_start]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Au",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>i(s).period_end=r),type:"date",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[C,i(s).period_end]])])])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Format ",-1)),e("div",te,[(l(!0),a(x,null,m(c.formats,(r,u)=>(l(),a("label",{key:u,class:$(["flex items-center p-3 border rounded-lg cursor-pointer transition-colors",i(s).format===u?"border-violet-500 bg-violet-50 dark:bg-violet-900/20":"border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"])},[v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=D=>i(s).format=D),value:u,type:"radio",class:"h-4 w-4 text-violet-600 focus:ring-violet-500"},null,8,re),[[U,i(s).format]]),e("span",se,d(r),1)],2))),128))])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Options ",-1)),e("div",oe,[e("label",ae,[v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>i(s).include_credit_notes=r),type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,512),[[M,i(s).include_credit_notes]]),t[10]||(t[10]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Inclure les avoirs (notes de crédit) ",-1))]),e("label",le,[v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>i(s).anonymize=r),type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,512),[[M,i(s).anonymize]]),t[11]||(t[11]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Anonymiser les données clients (test) ",-1))])])]),n.value||b.value||y.value?(l(),a("div",de,[t[21]||(t[21]=e("h3",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"Aperçu",-1)),b.value?(l(),a("div",ne,[...t[13]||(t[13]=[e("svg",{class:"animate-spin h-5 w-5 text-violet-500",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",{class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},"Chargement...",-1)])])):y.value?(l(),a("div",ie,d(y.value),1)):n.value?(l(),a("div",ue,[e("div",ce,[t[14]||(t[14]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Factures",-1)),e("span",ge,d(n.value.invoices_count),1)]),i(s).include_credit_notes?(l(),a("div",xe,[t[15]||(t[15]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Avoirs",-1)),e("span",me,d(n.value.credit_notes_count),1)])):g("",!0),e("div",ye,[t[16]||(t[16]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Total HT",-1)),e("span",pe,d(f(n.value.total_ht)),1)]),e("div",ve,[t[17]||(t[17]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Total TVA",-1)),e("span",be,d(f(n.value.total_vat)),1)]),e("div",fe,[t[18]||(t[18]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Total TTC",-1)),e("span",ke,d(f(n.value.total_ttc)),1)]),e("div",_e,[n.value.sequence_valid?(l(),a("div",he,[...t[19]||(t[19]=[e("svg",{class:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),z(" Séquençage OK ",-1)])])):(l(),a("div",we,[t[20]||(t[20]=e("div",{class:"flex items-center"},[e("svg",{class:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),z(" Trous dans la numérotation ")],-1)),(p=n.value.sequence_errors)!=null&&p.length?(l(),a("ul",Ae,[(l(!0),a(x,null,m(n.value.sequence_errors.slice(0,5),r=>(l(),a("li",{key:r},d(r),1))),128)),n.value.sequence_errors.length>5?(l(),a("li",Ce,"... et "+d(n.value.sequence_errors.length-5)+" autres",1)):g("",!0)])):g("",!0)]))])])):g("",!0)])):g("",!0),e("div",$e,[e("button",{type:"submit",disabled:i(s).processing||!n.value||n.value.invoices_count===0&&n.value.credit_notes_count===0,class:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[i(s).processing?(l(),a("span",ze,"Génération...")):(l(),a("span",Fe,"Générer l'export"))],8,Me)])],32)]),e("div",Se,[t[25]||(t[25]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," Historique des exports ",-1)),c.exports.length===0?(l(),a("div",Te," Aucun export réalisé ")):(l(),a("div",Ve,[(l(!0),a(x,null,m(c.exports,r=>(l(),a("div",{key:r.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",je,[e("div",Ee,[e("span",Be,d(r.period_label),1),e("span",{class:$(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",h(r.status).class])},d(h(r.status).text),3)]),e("div",qe,[e("span",null,d(r.format_label),1),r.documents_count?(l(),a("span",De,d(r.documents_count)+" docs",1)):g("",!0),e("span",null,d(j(r.created_at)),1)]),r.sequence_valid?g("",!0):(l(),a("div",Le," Séquençage incomplet "))]),e("div",Ye,[r.status==="completed"?(l(),a("button",{key:0,onClick:u=>B(r),class:"p-2 text-violet-600 hover:bg-violet-100 dark:hover:bg-violet-900/30 rounded-lg",title:"Télécharger"},[...t[23]||(t[23]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Ne)):g("",!0),e("button",{onClick:u=>q(r),class:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",title:"Supprimer"},[...t[24]||(t[24]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,He)])]))),128))]))])]),t[26]||(t[26]=e("div",{class:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},[e("div",{class:"flex"},[e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-blue-800 dark:text-blue-300"}," À propos du FAIA "),e("p",{class:"mt-1 text-sm text-blue-700 dark:text-blue-400"}," Le FAIA (Fichier d'Audit Informatisé de l'AED) est un standard exigé par l'Administration des contributions directes du Luxembourg lors des contrôles fiscaux. L'export XML FAIA respecte le format SAF-T luxembourgeois. ")])])],-1))])])]}),_:1})],64))}};export{Ke as default};
