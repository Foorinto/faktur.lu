import{k as i,p as J,c as l,a as k,u as d,h as K,w as u,b as e,q as S,o as a,F as g,r as p,t as n,v as T,s as c,g as M,d as x,n as F,i as j,j as U,G as I}from"./app-B2KrZOCa.js";import{_ as Q}from"./AppLayout-CMhKAyAT.js";import"./ApplicationLogo-CBvPJGvQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-Dw9Qk6Ag.js";const W={class:"flex items-center justify-between"},X={class:"mb-6 flex flex-wrap gap-4"},Y=["value"],Z=["value"],ee=["value"],te={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},re={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},se={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800"},ae={key:0},le={colspan:"7",class:"py-10 text-center text-sm text-gray-500 dark:text-gray-400"},ne={class:"whitespace-nowrap py-4 pl-4 pr-3 sm:pl-6"},oe={key:0,class:"text-red-600 dark:text-red-400"},ie={key:0,class:"text-xs text-gray-500 dark:text-gray-400 truncate max-w-[200px]"},de={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400"},ue={class:"hidden whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400 md:table-cell"},ge={class:"hidden whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400 lg:table-cell"},ce={class:"whitespace-nowrap px-3 py-4 text-sm"},xe={key:0,class:"inline-flex relative"},ye=["value","onChange","disabled"],he=["value"],fe=["value"],pe={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},me={class:"flex items-center justify-end gap-5"},ve=["onClick"],ke=["href"],be={key:0,class:"mt-6 flex items-center justify-between"},we={class:"text-sm text-gray-700 dark:text-gray-400"},Ce={class:"isolate inline-flex -space-x-px rounded-md shadow-sm"},_e={key:1,class:"fixed inset-0 z-50 overflow-hidden"},Me={class:"flex items-center justify-center min-h-screen p-4"},Fe={class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col"},je={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"},ze={class:"text-lg font-medium text-gray-900 dark:text-white"},Ae={class:"flex items-center space-x-2"},Be=["href"],Le={class:"flex-1 overflow-auto p-6 bg-gray-100 dark:bg-gray-900"},Ve={key:0,class:"flex items-center justify-center h-96"},He=["innerHTML"],Ue={__name:"Index",props:{invoices:Object,filters:Object,statuses:Array,years:Array,clients:Array},setup(o){const z=o,b=i(z.filters.status||""),w=i(z.filters.year||""),C=i(z.filters.client_id||""),A=i(!1),m=i(""),B=i(!1),y=i(null),O=async s=>{y.value=s,A.value=!0,B.value=!0;try{if(s.status==="draft"){const r=await I.get(route("invoices.preview-draft",s.id));m.value=r.data.html}else{const r=await I.get(route("invoices.preview-html",s.id));m.value=r.data.html}}catch(r){console.error("Error loading preview:",r),m.value=`<p style="color: red; padding: 20px;">Erreur lors du chargement de l'aperçu</p>`}finally{B.value=!1}},L=()=>{A.value=!1,m.value="",y.value=null};J([b,w,C],()=>{U.get(route("invoices.index"),{status:b.value||void 0,year:w.value||void 0,client_id:C.value||void 0},{preserveState:!0,replace:!0})});const N=s=>{const r={draft:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",finalized:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",sent:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",paid:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"};return r[s]||r.draft},V=s=>({draft:"Brouillon",finalized:"Finalisée",sent:"Envoyée",paid:"Payée",cancelled:"Annulée"})[s]||s,R=(s,r="EUR")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:r}).format(s),D=s=>s?new Date(s).toLocaleDateString("fr-FR"):"-",_=i(null),$=s=>({finalized:["sent","paid"],sent:["paid"]})[s]||[],q=s=>["finalized","sent"].includes(s.status),G=(s,r)=>{_.value=s.id;const v={sent:"invoices.mark-sent",paid:"invoices.mark-paid"}[r];v&&U.post(route(v,s.id),{},{preserveScroll:!0,onFinish:()=>{_.value=null}})};return(s,r)=>(a(),l(g,null,[k(d(K),{title:"Factures"}),k(Q,null,{header:u(()=>[e("div",W,[r[4]||(r[4]=e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Factures ",-1)),k(d(c),{href:s.route("invoices.create"),class:"inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"},{default:u(()=>[...r[3]||(r[3]=[e("svg",{class:"-ml-0.5 mr-1.5 h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})],-1),M(" Nouvelle facture ",-1)])]),_:1},8,["href"])])]),default:u(()=>{var H,v,P,E;return[e("div",X,[S(e("select",{"onUpdate:modelValue":r[0]||(r[0]=t=>b.value=t),class:"rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 dark:bg-gray-800 dark:text-white dark:ring-gray-600 sm:text-sm"},[r[5]||(r[5]=e("option",{value:""},"Tous les statuts",-1)),(a(!0),l(g,null,p(o.statuses,t=>(a(),l("option",{key:t.value,value:t.value},n(t.label),9,Y))),128))],512),[[T,b.value]]),S(e("select",{"onUpdate:modelValue":r[1]||(r[1]=t=>w.value=t),class:"rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 dark:bg-gray-800 dark:text-white dark:ring-gray-600 sm:text-sm"},[r[6]||(r[6]=e("option",{value:""},"Toutes les années",-1)),(a(!0),l(g,null,p(o.years,t=>(a(),l("option",{key:t,value:t},n(t),9,Z))),128))],512),[[T,w.value]]),S(e("select",{"onUpdate:modelValue":r[2]||(r[2]=t=>C.value=t),class:"rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 dark:bg-gray-800 dark:text-white dark:ring-gray-600 sm:text-sm"},[r[7]||(r[7]=e("option",{value:""},"Tous les clients",-1)),(a(!0),l(g,null,p(o.clients,t=>(a(),l("option",{key:t.id,value:t.id},n(t.name),9,ee))),128))],512),[[T,C.value]])]),e("div",te,[e("table",re,[r[16]||(r[16]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-white sm:pl-6"}," N° "),e("th",{class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white"}," Client "),e("th",{class:"hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white md:table-cell"}," Date "),e("th",{class:"hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white lg:table-cell"}," Échéance "),e("th",{class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900 dark:text-white"}," Total TTC "),e("th",{class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white"}," Statut "),e("th",{class:"relative py-3.5 pl-3 pr-4 sm:pr-6"},[e("span",{class:"sr-only"},"Actions")])])],-1)),e("tbody",se,[o.invoices.data.length===0?(a(),l("tr",ae,[e("td",le,[r[9]||(r[9]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),r[10]||(r[10]=e("p",{class:"mt-2"},"Aucune facture trouvée.",-1)),k(d(c),{href:s.route("invoices.create"),class:"mt-4 inline-flex items-center text-indigo-600 hover:text-indigo-500 dark:text-indigo-400"},{default:u(()=>[...r[8]||(r[8]=[M(" Créer votre première facture ",-1)])]),_:1},8,["href"])])])):x("",!0),(a(!0),l(g,null,p(o.invoices.data,t=>{var h;return a(),l("tr",{key:t.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",ne,[k(d(c),{href:t.status==="draft"?s.route("invoices.edit",t.id):s.route("invoices.show",t.id),class:"font-medium text-gray-900 hover:text-indigo-600 dark:text-white dark:hover:text-indigo-400"},{default:u(()=>[t.type==="credit_note"?(a(),l("span",oe," NC- ")):x("",!0),M(" "+n(t.number||"BROUILLON"),1)]),_:2},1032,["href"]),t.title?(a(),l("p",ie,n(t.title),1)):x("",!0)]),e("td",de,n((h=t.client)==null?void 0:h.name),1),e("td",ue,n(D(t.issued_at)),1),e("td",ge,n(D(t.due_at)),1),e("td",{class:F(["whitespace-nowrap px-3 py-4 text-right text-sm font-medium",t.type==="credit_note"?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"])},n(R(t.total_ttc,t.currency)),3),e("td",ce,[q(t)?(a(),l("div",xe,[e("select",{value:t.status,onChange:f=>G(t,f.target.value),disabled:_.value===t.id,class:F([N(t.status),"appearance-none cursor-pointer rounded-full pl-2.5 pr-6 py-0.5 text-xs font-medium border-0 focus:ring-2 focus:ring-indigo-500",_.value===t.id?"opacity-50":""])},[e("option",{value:t.status},n(V(t.status)),9,he),(a(!0),l(g,null,p($(t.status),f=>(a(),l("option",{key:f,value:f}," → "+n(V(f)),9,fe))),128))],42,ye)])):(a(),l("span",{key:1,class:F([N(t.status),"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"])},n(V(t.status)),3))]),e("td",pe,[e("div",me,[e("button",{type:"button",onClick:f=>O(t),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",title:"Aperçu"},[...r[11]||(r[11]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.64 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.64 0-8.573-3.007-9.963-7.178z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])],8,ve),e("a",{href:t.status==="draft"?s.route("invoices.draft-pdf",t.id):s.route("invoices.pdf.stream",t.id),target:"_blank",class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",title:"Télécharger PDF"},[...r[12]||(r[12]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1)])],8,ke),t.status==="draft"?(a(),j(d(c),{key:0,href:s.route("invoices.edit",t.id),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",title:"Modifier"},{default:u(()=>[...r[13]||(r[13]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})],-1)])]),_:1},8,["href"])):(a(),j(d(c),{key:1,href:s.route("invoices.show",t.id),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",title:"Voir"},{default:u(()=>[...r[14]||(r[14]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})],-1)])]),_:1},8,["href"])),t.status==="draft"?(a(),j(d(c),{key:2,href:s.route("invoices.finalize",t.id),method:"post",as:"button",class:"inline-flex items-center gap-1 text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",title:"Finaliser"},{default:u(()=>[...r[15]||(r[15]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("span",{class:"text-sm"},"Finaliser",-1)])]),_:1},8,["href"])):x("",!0)])])])}),128))])])]),o.invoices.links&&o.invoices.links.length>3?(a(),l("div",be,[e("div",we," Affichage de "+n(o.invoices.from)+" à "+n(o.invoices.to)+" sur "+n(o.invoices.total)+" factures ",1),e("nav",Ce,[(a(!0),l(g,null,p(o.invoices.links,(t,h)=>(a(),l(g,{key:h},[t.url?(a(),j(d(c),{key:0,href:t.url,class:F([t.active?"z-10 bg-indigo-600 text-white":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:text-gray-300 dark:ring-gray-600 dark:hover:bg-gray-700","relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20",h===0?"rounded-l-md":"",h===o.invoices.links.length-1?"rounded-r-md":""]),innerHTML:t.label,"preserve-scroll":""},null,8,["href","class","innerHTML"])):x("",!0)],64))),128))])])):x("",!0),A.value?(a(),l("div",_e,[e("div",Me,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:L}),e("div",Fe,[e("div",je,[e("h3",ze," Aperçu - "+n(((H=y.value)==null?void 0:H.number)||"Brouillon"),1),e("div",Ae,[e("a",{href:((v=y.value)==null?void 0:v.status)==="draft"?s.route("invoices.draft-pdf",(P=y.value)==null?void 0:P.id):s.route("invoices.pdf.stream",(E=y.value)==null?void 0:E.id),target:"_blank",class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300"},[...r[17]||(r[17]=[e("svg",{class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z"}),e("path",{d:"M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z"})],-1),M(" PDF ",-1)])],8,Be),e("button",{type:"button",onClick:L,class:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"},[...r[18]||(r[18]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Le,[B.value?(a(),l("div",Ve,[...r[19]||(r[19]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)])])):(a(),l("div",{key:1,class:"bg-white shadow-lg mx-auto",style:{width:"210mm","min-height":"297mm","transform-origin":"top center"},innerHTML:m.value},null,8,He))]),e("div",{class:"flex items-center justify-end px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},[e("button",{type:"button",onClick:L,class:"inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-600 dark:text-white dark:ring-gray-500"}," Fermer ")])])])])):x("",!0)]}),_:1})],64))}};export{Ue as default};
