import{e as I,c as o,a as k,u as g,h as M,w as p,b as e,o as l,d as m,t as r,y as P,F as u,r as x,q as _,v as B,z as L,A as V,k as w,j as E}from"./app-BNdkYu5R.js";import{_ as O}from"./AppLayout-CQ5EpIy-.js";import"./ApplicationLogo-Btd2wIUd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-7-ZIUky-.js";const T={class:"py-6"},$={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},H={key:0,class:"mb-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4"},N={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6"},R={class:"mb-4"},U={class:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1"},q={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},G={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},W={class:"text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},J={class:"text-2xl font-bold text-gray-900 dark:text-white"},K={class:"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"},Q={class:"text-2xl font-bold text-green-600 dark:text-green-400"},X={class:"text-center p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg"},Y={class:"text-2xl font-bold text-amber-600 dark:text-amber-400"},Z={class:"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},ee={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},te={key:0,class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},se={class:"flex gap-4 mt-2"},re={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ae={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},oe={class:"flex items-center justify-between mb-4"},le={class:"text-lg font-medium text-gray-900 dark:text-white"},ne=["value"],de={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ie={key:1},ce={class:"flex items-center gap-4 mb-3 pb-3 border-b border-gray-200 dark:border-gray-700"},ge={class:"flex items-center"},ue=["disabled"],ve={key:0},xe={key:1},me={class:"space-y-2 max-h-96 overflow-y-auto"},be={class:"flex items-center gap-3"},he=["checked","onChange"],ye={class:"text-sm font-medium text-gray-900 dark:text-white"},fe={class:"text-xs text-gray-500 dark:text-gray-400"},ke=["onClick"],pe={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},_e={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},we={key:1,class:"space-y-2 max-h-96 overflow-y-auto"},Ae={class:"flex-1 min-w-0"},Ce={class:"flex items-center gap-2"},De={class:"text-sm font-medium text-gray-900 dark:text-white"},Fe={class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300"},Se={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},je={class:"mt-1 text-xs text-gray-400 dark:text-gray-500 font-mono truncate"},ze={class:"flex items-center gap-1 ml-4"},Ie=["href"],Me=["onClick"],Oe={__name:"Index",props:{stats:Object,pendingInvoices:Array,recentlyArchived:Array,ghostscriptAvailable:Boolean,formats:Object},setup(n){const b=n,d=w([]),v=w(!1),c=I({invoice_ids:[],format:"pdfa-1b"}),A=a=>{const t=d.value.indexOf(a);t===-1?d.value.push(a):d.value.splice(t,1)},C=()=>{v.value?d.value=b.pendingInvoices.map(a=>a.id):d.value=[]},D=a=>{E.post(route("invoices.archive",a.id),{format:c.format})},F=()=>{d.value.length!==0&&(c.invoice_ids=d.value,c.post(route("archive.batch"),{onSuccess:()=>{d.value=[],v.value=!1}}))},S=async a=>{try{const s=await(await fetch(route("invoices.archive.verify",a.id))).json();s.valid?alert("Intégrité vérifiée : Le fichier est intact."):alert("Erreur d'intégrité : "+s.error)}catch{alert("Erreur lors de la vérification.")}},h=a=>a?new Date(a).toLocaleDateString("fr-FR"):"-",j=a=>a?new Date(a).toLocaleString("fr-FR"):"-",y=a=>({"pdfa-1b":"PDF/A-1b","pdfa-3b":"PDF/A-3b",pdf:"PDF"})[a]||a,z=V(()=>`${b.stats.archive_percentage}%`);return(a,t)=>(l(),o(u,null,[k(g(M),{title:"Archivage PDF/A"}),k(O,null,{header:p(()=>[...t[2]||(t[2]=[e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Archivage Documents ",-1)])]),default:p(()=>[e("div",T,[e("div",$,[n.ghostscriptAvailable?m("",!0):(l(),o("div",H,[...t[3]||(t[3]=[e("div",{class:"flex"},[e("svg",{class:"h-5 w-5 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-amber-800 dark:text-amber-300"}," Conversion PDF/A non disponible "),e("p",{class:"mt-1 text-sm text-amber-700 dark:text-amber-400"}," Ghostscript n'est pas installé sur ce serveur. Les documents seront archivés au format PDF standard. Pour une conformité PDF/A complète, contactez votre hébergeur. ")])],-1)])])),e("div",N,[t[9]||(t[9]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," Statut Global ",-1)),e("div",R,[e("div",U,[e("span",null,r(n.stats.total_archived)+" / "+r(n.stats.total_finalized)+" documents archivés",1),e("span",null,r(n.stats.archive_percentage)+"%",1)]),e("div",q,[e("div",{class:"bg-violet-600 h-3 rounded-full transition-all duration-500",style:P({width:z.value})},null,4)])]),e("div",G,[e("div",W,[e("div",J,r(n.stats.total_finalized),1),t[4]||(t[4]=e("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total finalisées",-1))]),e("div",K,[e("div",Q,r(n.stats.total_archived),1),t[5]||(t[5]=e("div",{class:"text-sm text-green-600 dark:text-green-400"},"Archivées",-1))]),e("div",X,[e("div",Y,r(n.stats.not_archived),1),t[6]||(t[6]=e("div",{class:"text-sm text-amber-600 dark:text-amber-400"},"En attente",-1))]),e("div",Z,[e("div",ee,r(n.stats.expiring_this_year),1),t[7]||(t[7]=e("div",{class:"text-sm text-blue-600 dark:text-blue-400"},"Expirent cette année",-1))])]),Object.keys(n.stats.by_format).length>0?(l(),o("div",te,[t[8]||(t[8]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Par format :",-1)),e("div",se,[(l(!0),o(u,null,x(n.stats.by_format,(s,i)=>(l(),o("span",{key:i,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"},r(y(i))+": "+r(s),1))),128))])])):m("",!0)]),e("div",re,[e("div",ae,[e("div",oe,[e("h2",le," Documents non archivés ("+r(n.pendingInvoices.length)+") ",1),_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>g(c).format=s),class:"text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},[(l(!0),o(u,null,x(n.formats,(s,i)=>(l(),o("option",{key:i,value:i},r(s),9,ne))),128))],512),[[B,g(c).format]])]),n.pendingInvoices.length===0?(l(),o("div",de," Tous les documents sont archivés ! ")):(l(),o("div",ie,[e("div",ce,[e("label",ge,[_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),onChange:C,type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,544),[[L,v.value]]),t[10]||(t[10]=e("span",{class:"ml-2 text-sm text-gray-600 dark:text-gray-400"},"Tout sélectionner",-1))]),d.value.length>0?(l(),o("button",{key:0,onClick:F,disabled:g(c).processing,class:"ml-auto px-3 py-1 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 disabled:opacity-50"},[g(c).processing?(l(),o("span",ve,"Archivage...")):(l(),o("span",xe,"Archiver ("+r(d.value.length)+")",1))],8,ue)):m("",!0)]),e("div",me,[(l(!0),o(u,null,x(n.pendingInvoices,s=>{var i;return l(),o("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",be,[e("input",{type:"checkbox",checked:d.value.includes(s.id),onChange:f=>A(s.id),class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,40,he),e("div",null,[e("div",ye,r(s.number),1),e("div",fe,r((i=s.client)==null?void 0:i.name)+" | "+r(h(s.issued_at)),1)])]),e("button",{onClick:f=>D(s),class:"p-2 text-violet-600 hover:bg-violet-100 dark:hover:bg-violet-900/30 rounded-lg",title:"Archiver"},[...t[11]||(t[11]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})],-1)])],8,ke)])}),128))])]))]),e("div",pe,[t[15]||(t[15]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"}," Récemment archivés ",-1)),n.recentlyArchived.length===0?(l(),o("div",_e," Aucun document archivé ")):(l(),o("div",we,[(l(!0),o(u,null,x(n.recentlyArchived,s=>{var i;return l(),o("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",Ae,[e("div",Ce,[e("span",De,r(s.number),1),e("span",Fe,r(y(s.archive_format)),1)]),e("div",Se,[e("span",null,"Archivé le "+r(j(s.archived_at)),1),t[12]||(t[12]=e("span",{class:"mx-1"},"|",-1)),e("span",null,"Expire le "+r(h(s.archive_expires_at)),1)]),e("div",je," SHA256: "+r((i=s.archive_checksum)==null?void 0:i.substring(0,16))+"... ",1)]),e("div",ze,[e("a",{href:a.route("invoices.archive.download",s.id),class:"p-2 text-violet-600 hover:bg-violet-100 dark:hover:bg-violet-900/30 rounded-lg",title:"Télécharger"},[...t[13]||(t[13]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Ie),e("button",{onClick:f=>S(s),class:"p-2 text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-600 rounded-lg",title:"Vérifier l'intégrité"},[...t[14]||(t[14]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)])],8,Me)])])}),128))]))])]),t[16]||(t[16]=e("div",{class:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},[e("div",{class:"flex"},[e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-blue-800 dark:text-blue-300"}," Archivage légal Luxembourg "),e("p",{class:"mt-1 text-sm text-blue-700 dark:text-blue-400"}," La réglementation luxembourgeoise exige une conservation des documents comptables pendant 10 ans. Le format PDF/A (ISO 19005) garantit la lisibilité et l'intégrité des documents sur cette durée. Un checksum SHA256 est calculé pour chaque document afin de vérifier son intégrité. ")])])],-1))])])]),_:1})],64))}};export{Oe as default};
