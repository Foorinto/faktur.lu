import{r as xt,z as yt,A as vt,c as r,a as y,b as _t,h as jt,i as v,d as t,x as o,t as l,e as a,o as c,F as f,j as _,g as mt,p as ft,B as bt}from"./app-D_LDRm1B.js";import{_ as pt}from"./AdminLayout-elQcmgV6.js";import{_ as kt}from"./SecondaryButton-ZqQdHcd0.js";const qt={class:"flex items-center justify-between"},St={class:"flex items-center gap-3"},At={class:"flex rounded-lg bg-slate-700 p-1"},Tt=["onClick"],Ct={key:0,class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Lt={class:"mb-6 rounded-xl bg-slate-800 p-6"},Bt={class:"flex items-center justify-between"},Mt={class:"flex items-center gap-4"},Pt={class:"text-right text-sm text-slate-400"},Rt={class:"mt-4 flex flex-wrap gap-2"},Et={class:"grid gap-6 lg:grid-cols-2 xl:grid-cols-3"},zt={class:"rounded-xl bg-slate-800 p-6"},Dt={class:"space-y-3"},Ft={class:"flex justify-between"},Ot={class:"text-white font-mono"},Qt={class:"flex justify-between"},Vt={class:"text-white font-mono"},$t={class:"flex justify-between"},It={class:"flex justify-between"},Jt={class:"text-white font-mono"},Nt={class:"flex justify-between"},Ut={class:"text-white font-mono"},Ht={class:"flex justify-between"},Gt={class:"rounded-xl bg-slate-800 p-6"},Kt={class:"space-y-3"},Wt={class:"flex justify-between"},Xt={class:"flex justify-between"},Yt={class:"text-white font-mono"},Zt={class:"flex justify-between"},te={class:"text-white font-mono"},ee={class:"flex justify-between"},se={class:"text-white font-mono"},le={class:"flex justify-between"},ie={class:"text-white font-mono"},oe={class:"rounded-xl bg-slate-800 p-6"},ne={class:"space-y-3"},de={class:"flex justify-between"},ae={class:"flex justify-between"},re={class:"text-white font-mono"},ce={class:"flex justify-between"},ue={class:"text-white font-mono"},xe={class:"flex justify-between"},me={class:"text-white"},fe={class:"flex justify-between"},be={class:"text-white"},he={class:"flex justify-between"},we={class:"text-white"},ge={class:"rounded-xl bg-slate-800 p-6"},ye={class:"space-y-3"},ve={class:"flex justify-between"},_e={class:"text-white font-mono"},je={class:"flex justify-between"},pe={class:"text-white font-mono"},ke={class:"flex justify-between"},qe={class:"text-white font-mono"},Se={class:"flex justify-between"},Ae={class:"text-white font-mono"},Te={class:"flex justify-between"},Ce={class:"text-white font-mono"},Le={class:"rounded-xl bg-slate-800 p-6"},Be={class:"space-y-3"},Me={class:"flex justify-between"},Pe={class:"text-white font-mono"},Re={class:"flex justify-between"},Ee={class:"flex justify-between"},ze={class:"text-white font-mono"},De={class:"rounded-xl bg-slate-800 p-6"},Fe={class:"space-y-3 text-sm"},Oe={class:"flex justify-between"},Qe={class:"text-slate-300"},Ve={class:"text-yellow-400"},$e={class:"text-red-400"},Ie={class:"flex justify-between"},Je={class:"text-slate-300"},Ne={class:"text-yellow-400"},Ue={class:"text-red-400"},He={class:"flex justify-between"},Ge={class:"text-slate-300"},Ke={class:"text-yellow-400"},We={class:"text-red-400"},Xe={class:"flex justify-between"},Ye={class:"text-slate-300"},Ze={class:"text-yellow-400"},ts={class:"text-red-400"},es={class:"flex justify-between"},ss={class:"text-slate-300"},ls={class:"text-yellow-400"},is={class:"text-red-400"},os={class:"mt-6 rounded-xl bg-slate-800 p-6"},ns={class:"overflow-x-auto"},ds={class:"w-full text-left text-sm"},as={class:"divide-y divide-slate-700"},rs={class:"py-3 font-mono text-xs max-w-xs truncate"},cs={class:"py-3"},us={class:"py-3 text-right"},xs={key:0},hs={__name:"Index",props:{metrics:Object,timeSeries:Array,thresholds:Object,period:String},setup(s){const j=s,b=xt(j.period),x=xt(!1);let h=null;const p=[{value:"1h",label:"1 heure"},{value:"24h",label:"24 heures"},{value:"7d",label:"7 jours"},{value:"30d",label:"30 jours"}],ht=n=>{b.value=n,ft.get(route("admin.monitoring"),{period:n},{preserveState:!0,preserveScroll:!0})},k=()=>{x.value=!0,ft.reload({only:["metrics","timeSeries"],onFinish:()=>{x.value=!1}})},q=n=>{switch(n){case"critical":return"bg-red-500";case"warning":return"bg-yellow-500";default:return"bg-green-500"}},wt=n=>{switch(n){case"critical":return"text-red-400";case"warning":return"text-yellow-400";default:return"text-green-400"}},u=n=>n>=1e3?`${(n/1e3).toFixed(2)}s`:`${Math.round(n)}ms`,w=bt(()=>{var d;const n=((d=j.metrics)==null?void 0:d.alerts)||{},e=Object.values(n);return e.includes("critical")?"critical":e.includes("warning")?"warning":"ok"}),gt=bt(()=>{switch(w.value){case"critical":return"Critique";case"warning":return"Attention";default:return"OK"}});return yt(()=>{h=setInterval(k,3e4)}),vt(()=>{h&&clearInterval(h)}),(n,e)=>(c(),r(f,null,[y(_t(jt),{title:"Monitoring"}),y(pt,null,{header:v(()=>[t("div",qt,[e[1]||(e[1]=t("h1",{class:"text-xl font-semibold text-white"},"Monitoring",-1)),t("div",St,[t("div",At,[(c(),r(f,null,_(p,d=>t("button",{key:d.value,class:o(["rounded-md px-3 py-1 text-sm font-medium transition-colors",b.value===d.value?"bg-purple-600 text-white":"text-slate-400 hover:text-white"]),onClick:g=>ht(d.value)},l(d.label),11,Tt)),64))]),y(kt,{disabled:x.value,onClick:k},{default:v(()=>[x.value?(c(),r("svg",Ct,[...e[0]||(e[0]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):mt("",!0),a(" "+l(x.value?"Actualisation...":"Actualiser"),1)]),_:1},8,["disabled"])])])]),default:v(()=>{var d,g,S,A,T,C,L,B,M,P,R,E,z,D,F,O,Q,V,$,I,J,N,U,H,G,K,W,X,Y,Z,tt,et,st,lt,it,ot,nt,dt,at,rt,ct,ut;return[t("div",Lt,[t("div",Bt,[t("div",Mt,[t("div",{class:o(["h-4 w-4 rounded-full",q(w.value)])},null,2),t("div",null,[e[2]||(e[2]=t("h2",{class:"text-lg font-semibold text-white"},"État de santé global",-1)),t("p",{class:o(["text-sm",wt(w.value)])},l(gt.value),3)])]),t("div",Pt,[a(" Période : "+l((d=p.find(i=>i.value===b.value))==null?void 0:d.label)+" ",1),e[3]||(e[3]=t("br",null,null,-1)),e[4]||(e[4]=a(" Auto-refresh : 30s ",-1))])]),t("div",Rt,[(c(!0),r(f,null,_(s.metrics.alerts,(i,m)=>(c(),r("div",{key:m,class:o(["flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium",i==="critical"?"bg-red-500/20 text-red-400":i==="warning"?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"])},[t("div",{class:o(["h-2 w-2 rounded-full",q(i)])},null,2),a(" "+l(m.replace("_"," ")),1)],2))),128))])]),t("div",Et,[t("div",zt,[e[11]||(e[11]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Performance Requêtes",-1)),t("dl",Dt,[t("div",Ft,[e[5]||(e[5]=t("dt",{class:"text-slate-400"},"Requêtes totales",-1)),t("dd",Ot,l((S=(g=s.metrics.requests)==null?void 0:g.total)==null?void 0:S.toLocaleString()),1)]),t("div",Qt,[e[6]||(e[6]=t("dt",{class:"text-slate-400"},"Req/min",-1)),t("dd",Vt,l((A=s.metrics.requests)==null?void 0:A.requests_per_minute),1)]),t("div",$t,[e[7]||(e[7]=t("dt",{class:"text-slate-400"},"Temps moyen",-1)),t("dd",{class:o(["font-mono",((T=s.metrics.alerts)==null?void 0:T.response_time)==="critical"?"text-red-400":((C=s.metrics.alerts)==null?void 0:C.response_time)==="warning"?"text-yellow-400":"text-white"])},l(u((L=s.metrics.requests)==null?void 0:L.avg_response_time)),3)]),t("div",It,[e[8]||(e[8]=t("dt",{class:"text-slate-400"},"P95",-1)),t("dd",Jt,l(u((B=s.metrics.requests)==null?void 0:B.p95_response_time)),1)]),t("div",Nt,[e[9]||(e[9]=t("dt",{class:"text-slate-400"},"P99",-1)),t("dd",Ut,l(u((M=s.metrics.requests)==null?void 0:M.p99_response_time)),1)]),t("div",Ht,[e[10]||(e[10]=t("dt",{class:"text-slate-400"},"Erreurs (5xx)",-1)),t("dd",{class:o(["font-mono",((P=s.metrics.alerts)==null?void 0:P.error_rate)==="critical"?"text-red-400":((R=s.metrics.alerts)==null?void 0:R.error_rate)==="warning"?"text-yellow-400":"text-green-400"])},l((E=s.metrics.requests)==null?void 0:E.error_count)+" ("+l((z=s.metrics.requests)==null?void 0:z.error_rate)+"%) ",3)])])]),t("div",Gt,[e[17]||(e[17]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Base de données",-1)),t("dl",Kt,[t("div",Wt,[e[12]||(e[12]=t("dt",{class:"text-slate-400"},"Requêtes/page (moy)",-1)),t("dd",{class:o(["font-mono",((D=s.metrics.alerts)==null?void 0:D.query_count)==="critical"?"text-red-400":((F=s.metrics.alerts)==null?void 0:F.query_count)==="warning"?"text-yellow-400":"text-white"])},l((O=s.metrics.database)==null?void 0:O.avg_queries_per_request),3)]),t("div",Xt,[e[13]||(e[13]=t("dt",{class:"text-slate-400"},"Requêtes/page (max)",-1)),t("dd",Yt,l((Q=s.metrics.database)==null?void 0:Q.max_queries_per_request),1)]),t("div",Zt,[e[14]||(e[14]=t("dt",{class:"text-slate-400"},"Temps SQL (moy)",-1)),t("dd",te,l(u((V=s.metrics.database)==null?void 0:V.avg_query_time_ms)),1)]),t("div",ee,[e[15]||(e[15]=t("dt",{class:"text-slate-400"},"Temps SQL (max)",-1)),t("dd",se,l(u(($=s.metrics.database)==null?void 0:$.max_query_time_ms)),1)]),t("div",le,[e[16]||(e[16]=t("dt",{class:"text-slate-400"},"Taille BDD",-1)),t("dd",ie,l((I=s.metrics.database)==null?void 0:I.database_size_mb)+" MB",1)])])]),t("div",oe,[e[24]||(e[24]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Système",-1)),t("dl",ne,[t("div",de,[e[18]||(e[18]=t("dt",{class:"text-slate-400"},"Disque utilisé",-1)),t("dd",{class:o(["font-mono",((J=s.metrics.alerts)==null?void 0:J.disk_usage)==="critical"?"text-red-400":((N=s.metrics.alerts)==null?void 0:N.disk_usage)==="warning"?"text-yellow-400":"text-white"])},l((U=s.metrics.system)==null?void 0:U.disk_used_percent)+"% ",3)]),t("div",ae,[e[19]||(e[19]=t("dt",{class:"text-slate-400"},"Espace libre",-1)),t("dd",re,l((H=s.metrics.system)==null?void 0:H.disk_free_gb)+" GB",1)]),t("div",ce,[e[20]||(e[20]=t("dt",{class:"text-slate-400"},"Stockage app",-1)),t("dd",ue,l((G=s.metrics.system)==null?void 0:G.storage_size_mb)+" MB",1)]),t("div",xe,[e[21]||(e[21]=t("dt",{class:"text-slate-400"},"PHP",-1)),t("dd",me,l((K=s.metrics.system)==null?void 0:K.php_version),1)]),t("div",fe,[e[22]||(e[22]=t("dt",{class:"text-slate-400"},"Limite mémoire",-1)),t("dd",be,l((W=s.metrics.system)==null?void 0:W.php_memory_limit),1)]),t("div",he,[e[23]||(e[23]=t("dt",{class:"text-slate-400"},"Laravel",-1)),t("dd",we,l((X=s.metrics.system)==null?void 0:X.laravel_version),1)])])]),t("div",ge,[e[30]||(e[30]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Application",-1)),t("dl",ye,[t("div",ve,[e[25]||(e[25]=t("dt",{class:"text-slate-400"},"Utilisateurs totaux",-1)),t("dd",_e,l((Y=s.metrics.application)==null?void 0:Y.users_total),1)]),t("div",je,[e[26]||(e[26]=t("dt",{class:"text-slate-400"},"Actifs (24h)",-1)),t("dd",pe,l((Z=s.metrics.application)==null?void 0:Z.users_active_24h),1)]),t("div",ke,[e[27]||(e[27]=t("dt",{class:"text-slate-400"},"Actifs (7j)",-1)),t("dd",qe,l((tt=s.metrics.application)==null?void 0:tt.users_active_7d),1)]),t("div",Se,[e[28]||(e[28]=t("dt",{class:"text-slate-400"},"Factures (aujourd'hui)",-1)),t("dd",Ae,l((et=s.metrics.application)==null?void 0:et.invoices_today),1)]),t("div",Te,[e[29]||(e[29]=t("dt",{class:"text-slate-400"},"Factures (semaine)",-1)),t("dd",Ce,l((st=s.metrics.application)==null?void 0:st.invoices_week),1)])])]),t("div",Le,[e[34]||(e[34]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Jobs & Queue",-1)),t("dl",Be,[t("div",Me,[e[31]||(e[31]=t("dt",{class:"text-slate-400"},"Jobs en attente",-1)),t("dd",Pe,l((lt=s.metrics.application)==null?void 0:lt.jobs_pending),1)]),t("div",Re,[e[32]||(e[32]=t("dt",{class:"text-slate-400"},"Jobs échoués (24h)",-1)),t("dd",{class:o(["font-mono",((it=s.metrics.alerts)==null?void 0:it.failed_jobs)==="critical"?"text-red-400":((ot=s.metrics.alerts)==null?void 0:ot.failed_jobs)==="warning"?"text-yellow-400":"text-green-400"])},l((nt=s.metrics.application)==null?void 0:nt.jobs_failed_24h),3)]),t("div",Ee,[e[33]||(e[33]=t("dt",{class:"text-slate-400"},"Métriques stockées",-1)),t("dd",ze,l((at=(dt=s.metrics.application)==null?void 0:dt.metrics_count)==null?void 0:at.toLocaleString()),1)])])]),t("div",De,[e[45]||(e[45]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Seuils d'alerte",-1)),t("dl",Fe,[t("div",Oe,[e[36]||(e[36]=t("dt",{class:"text-slate-400"},"Temps réponse",-1)),t("dd",Qe,[t("span",Ve,l(s.thresholds.response_time.warning)+"ms",1),e[35]||(e[35]=a(" / ",-1)),t("span",$e,l(s.thresholds.response_time.critical)+"ms",1)])]),t("div",Ie,[e[38]||(e[38]=t("dt",{class:"text-slate-400"},"Requêtes SQL",-1)),t("dd",Je,[t("span",Ne,l(s.thresholds.query_count.warning),1),e[37]||(e[37]=a(" / ",-1)),t("span",Ue,l(s.thresholds.query_count.critical),1)])]),t("div",He,[e[40]||(e[40]=t("dt",{class:"text-slate-400"},"Disque",-1)),t("dd",Ge,[t("span",Ke,l(s.thresholds.disk_usage.warning)+"%",1),e[39]||(e[39]=a(" / ",-1)),t("span",We,l(s.thresholds.disk_usage.critical)+"%",1)])]),t("div",Xe,[e[42]||(e[42]=t("dt",{class:"text-slate-400"},"Jobs échoués",-1)),t("dd",Ye,[t("span",Ze,l(s.thresholds.failed_jobs.warning),1),e[41]||(e[41]=a(" / ",-1)),t("span",ts,l(s.thresholds.failed_jobs.critical),1)])]),t("div",es,[e[44]||(e[44]=t("dt",{class:"text-slate-400"},"Taux erreur",-1)),t("dd",ss,[t("span",ls,l(s.thresholds.error_rate.warning)+"%",1),e[43]||(e[43]=a(" / ",-1)),t("span",is,l(s.thresholds.error_rate.critical)+"%",1)])])])])]),t("div",os,[e[48]||(e[48]=t("h2",{class:"mb-4 text-lg font-semibold text-white"},"Requêtes les plus lentes",-1)),t("div",ns,[t("table",ds,[e[47]||(e[47]=t("thead",null,[t("tr",{class:"border-b border-slate-700 text-slate-400"},[t("th",{class:"pb-3 font-medium"},"URL"),t("th",{class:"pb-3 font-medium"},"Méthode"),t("th",{class:"pb-3 font-medium text-right"},"Temps"),t("th",{class:"pb-3 font-medium text-right"},"Requêtes SQL"),t("th",{class:"pb-3 font-medium text-right"},"Status")])],-1)),t("tbody",as,[(c(!0),r(f,null,_((rt=s.metrics.requests)==null?void 0:rt.slowest,(i,m)=>(c(),r("tr",{key:m,class:"text-slate-300"},[t("td",rs,l(i.url),1),t("td",cs,[t("span",{class:o(["rounded px-2 py-0.5 text-xs font-medium",i.method==="GET"?"bg-green-500/20 text-green-400":i.method==="POST"?"bg-blue-500/20 text-blue-400":i.method==="PUT"?"bg-yellow-500/20 text-yellow-400":i.method==="DELETE"?"bg-red-500/20 text-red-400":"bg-slate-500/20 text-slate-400"])},l(i.method),3)]),t("td",{class:o(["py-3 text-right font-mono",i.response_time_ms>2e3?"text-red-400":i.response_time_ms>500?"text-yellow-400":""])},l(u(i.response_time_ms)),3),t("td",{class:o(["py-3 text-right font-mono",i.query_count>50?"text-red-400":i.query_count>20?"text-yellow-400":""])},l(i.query_count),3),t("td",us,[t("span",{class:o(["rounded px-2 py-0.5 text-xs font-medium",i.status_code>=500?"bg-red-500/20 text-red-400":i.status_code>=400?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"])},l(i.status_code),3)])]))),128)),(ut=(ct=s.metrics.requests)==null?void 0:ct.slowest)!=null&&ut.length?mt("",!0):(c(),r("tr",xs,[...e[46]||(e[46]=[t("td",{colspan:"5",class:"py-8 text-center text-slate-500"}," Aucune donnée disponible pour cette période ",-1)])]))])])])])]}),_:1})],64))}};export{hs as default};
