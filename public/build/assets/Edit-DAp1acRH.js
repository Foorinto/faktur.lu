import{e as T,k as B,c as d,a as o,u as s,h as E,w as y,b as e,f as N,q as i,B as f,o as l,F as x,r as b,t as m,v as h,z as q,d as k,g as F,s as M,A as V}from"./app-BNdkYu5R.js";import{_ as D}from"./AppLayout-CQ5EpIy-.js";import{_ as u,a as g}from"./InputError-j9SVREoo.js";import{P}from"./PrimaryButton-CRxPFKvX.js";import"./ApplicationLogo-Btd2wIUd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-7-ZIUky-.js";const R={class:"flex items-center space-x-4"},z={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},S={class:"px-6 py-4"},L={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},H={class:"sm:col-span-2"},I=["value"],$={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},G={class:"px-6 py-4"},J={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},O={class:"relative mt-1"},W=["value"],X={class:"mt-1 rounded-md bg-gray-50 dark:bg-gray-700 px-4 py-3 text-sm"},Y={class:"flex justify-between"},Z={class:"font-medium text-gray-900 dark:text-white"},K={class:"flex justify-between mt-1"},Q={class:"font-medium text-gray-900 dark:text-white"},ee={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},te={class:"px-6 py-4"},re={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},se=["value"],ae={class:"sm:col-span-2"},oe={class:"sm:col-span-2"},de={class:"flex items-center"},le={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},ne={class:"px-6 py-4"},ie={key:0,class:"mb-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-700 flex items-center justify-between"},ue={class:"flex items-center"},ge={class:"ml-3"},me={class:"text-sm font-medium text-gray-900 dark:text-white"},ce=["href"],pe={key:1,class:"flex items-center justify-center w-full"},ye={for:"attachment",class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600"},fe={key:2,class:"mt-3 text-sm text-gray-600 dark:text-gray-400"},xe={class:"flex justify-end space-x-3"},ve={key:0},be={key:1},Ae={__name:"Edit",props:{expense:Object,categories:Array,vatRates:Array,paymentMethods:Array},setup(c){const n=c,r=T({date:n.expense.date,provider_name:n.expense.provider_name,category:n.expense.category,amount_ht:n.expense.amount_ht,vat_rate:parseFloat(n.expense.vat_rate),description:n.expense.description||"",is_deductible:n.expense.is_deductible,payment_method:n.expense.payment_method||"",reference:n.expense.reference||"",attachment:null,remove_attachment:!1}),v=B(!!n.expense.attachment_url),_=V(()=>!r.amount_ht||!r.vat_rate?0:(parseFloat(r.amount_ht)*parseFloat(r.vat_rate)/100).toFixed(2)),A=V(()=>r.amount_ht?(parseFloat(r.amount_ht)+parseFloat(_.value)).toFixed(2):0),w=p=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(p),C=p=>{r.attachment=p.target.files[0],r.remove_attachment=!1},j=()=>{r.remove_attachment=!0,v.value=!1,r.attachment=null},U=()=>{r.post(route("expenses.update",n.expense.id),{forceFormData:!0,_method:"PUT"})};return(p,t)=>(l(),d(x,null,[o(s(E),{title:"Modifier la dépense"}),o(D,null,{header:y(()=>[e("div",R,[o(s(M),{href:p.route("expenses.index"),class:"text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400"},{default:y(()=>[...t[9]||(t[9]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z","clip-rule":"evenodd"})],-1)])]),_:1},8,["href"]),t[10]||(t[10]=e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Modifier la dépense ",-1))])]),default:y(()=>[e("form",{onSubmit:N(U,["prevent"]),class:"space-y-6"},[e("div",z,[t[12]||(t[12]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Informations")],-1)),e("div",S,[e("div",L,[e("div",null,[o(u,{for:"date",value:"Date"}),i(e("input",{id:"date","onUpdate:modelValue":t[0]||(t[0]=a=>s(r).date=a),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",required:""},null,512),[[f,s(r).date]]),o(g,{message:s(r).errors.date,class:"mt-2"},null,8,["message"])]),e("div",null,[o(u,{for:"provider_name",value:"Fournisseur"}),i(e("input",{id:"provider_name","onUpdate:modelValue":t[1]||(t[1]=a=>s(r).provider_name=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Ex: Fournisseur XYZ",required:""},null,512),[[f,s(r).provider_name]]),o(g,{message:s(r).errors.provider_name,class:"mt-2"},null,8,["message"])]),e("div",H,[o(u,{for:"category",value:"Catégorie"}),i(e("select",{id:"category","onUpdate:modelValue":t[2]||(t[2]=a=>s(r).category=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",required:""},[t[11]||(t[11]=e("option",{value:""},"Sélectionner une catégorie",-1)),(l(!0),d(x,null,b(c.categories,a=>(l(),d("option",{key:a.value,value:a.value},m(a.label),9,I))),128))],512),[[h,s(r).category]]),o(g,{message:s(r).errors.category,class:"mt-2"},null,8,["message"])])])])]),e("div",$,[t[16]||(t[16]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Montants")],-1)),e("div",G,[e("div",J,[e("div",null,[o(u,{for:"amount_ht",value:"Montant HT"}),e("div",O,[i(e("input",{id:"amount_ht","onUpdate:modelValue":t[3]||(t[3]=a=>s(r).amount_ht=a),type:"number",step:"0.01",min:"0.01",class:"block w-full rounded-md border-gray-300 pr-12 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"0.00",required:""},null,512),[[f,s(r).amount_ht]]),t[13]||(t[13]=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 dark:text-gray-400"},"EUR")],-1))]),o(g,{message:s(r).errors.amount_ht,class:"mt-2"},null,8,["message"])]),e("div",null,[o(u,{for:"vat_rate",value:"Taux TVA"}),i(e("select",{id:"vat_rate","onUpdate:modelValue":t[4]||(t[4]=a=>s(r).vat_rate=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",required:""},[(l(!0),d(x,null,b(c.vatRates,a=>(l(),d("option",{key:a.value,value:a.value},m(a.label),9,W))),128))],512),[[h,s(r).vat_rate,void 0,{number:!0}]]),o(g,{message:s(r).errors.vat_rate,class:"mt-2"},null,8,["message"])]),e("div",null,[o(u,{value:"Montants calculés"}),e("div",X,[e("div",Y,[t[14]||(t[14]=e("span",{class:"text-gray-500 dark:text-gray-400"},"TVA:",-1)),e("span",Z,m(w(_.value)),1)]),e("div",K,[t[15]||(t[15]=e("span",{class:"text-gray-500 dark:text-gray-400"},"TTC:",-1)),e("span",Q,m(w(A.value)),1)])])])])])]),e("div",ee,[t[19]||(t[19]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Informations complémentaires")],-1)),e("div",te,[e("div",re,[e("div",null,[o(u,{for:"payment_method",value:"Mode de paiement (optionnel)"}),i(e("select",{id:"payment_method","onUpdate:modelValue":t[5]||(t[5]=a=>s(r).payment_method=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},[t[17]||(t[17]=e("option",{value:""},"Sélectionner",-1)),(l(!0),d(x,null,b(c.paymentMethods,a=>(l(),d("option",{key:a.value,value:a.value},m(a.label),9,se))),128))],512),[[h,s(r).payment_method]]),o(g,{message:s(r).errors.payment_method,class:"mt-2"},null,8,["message"])]),e("div",null,[o(u,{for:"reference",value:"Référence facture (optionnel)"}),i(e("input",{id:"reference","onUpdate:modelValue":t[6]||(t[6]=a=>s(r).reference=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Ex: REF-0000"},null,512),[[f,s(r).reference]]),o(g,{message:s(r).errors.reference,class:"mt-2"},null,8,["message"])]),e("div",ae,[o(u,{for:"description",value:"Description (optionnel)"}),i(e("textarea",{id:"description","onUpdate:modelValue":t[7]||(t[7]=a=>s(r).description=a),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Notes ou détails sur cette dépense..."},null,512),[[f,s(r).description]]),o(g,{message:s(r).errors.description,class:"mt-2"},null,8,["message"])]),e("div",oe,[e("div",de,[i(e("input",{id:"is_deductible","onUpdate:modelValue":t[8]||(t[8]=a=>s(r).is_deductible=a),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700"},null,512),[[q,s(r).is_deductible]]),t[18]||(t[18]=e("label",{for:"is_deductible",class:"ml-2 block text-sm text-gray-900 dark:text-white"}," Dépense déductible fiscalement ",-1))])])])])]),e("div",le,[t[23]||(t[23]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Justificatif")],-1)),e("div",ne,[v.value?(l(),d("div",ie,[e("div",ue,[t[20]||(t[20]=e("svg",{class:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)),e("div",ge,[e("p",me,m(c.expense.attachment_filename),1),e("a",{href:c.expense.attachment_url,target:"_blank",class:"text-xs text-indigo-600 hover:text-indigo-500 dark:text-indigo-400"}," Voir le fichier ",8,ce)])]),e("button",{type:"button",onClick:j,class:"text-red-600 hover:text-red-500 dark:text-red-400"},[...t[21]||(t[21]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.519.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5z","clip-rule":"evenodd"})],-1)])])])):k("",!0),v.value?k("",!0):(l(),d("div",pe,[e("label",ye,[t[22]||(t[22]=e("div",{class:"flex flex-col items-center justify-center pt-5 pb-6"},[e("svg",{class:"w-8 h-8 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),e("p",{class:"mb-2 text-sm text-gray-500 dark:text-gray-400"},[e("span",{class:"font-semibold"},"Cliquez pour télécharger"),F(" ou glissez-déposez ")]),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"PDF, JPG, PNG ou WebP (max. 10 Mo)")],-1)),e("input",{id:"attachment",type:"file",class:"hidden",accept:".pdf,.jpg,.jpeg,.png,.webp",onChange:C},null,32)])])),s(r).attachment?(l(),d("div",fe," Nouveau fichier: "+m(s(r).attachment.name),1)):k("",!0),o(g,{message:s(r).errors.attachment,class:"mt-2"},null,8,["message"])])]),e("div",xe,[o(s(M),{href:p.route("expenses.index"),class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"},{default:y(()=>[...t[24]||(t[24]=[F(" Annuler ",-1)])]),_:1},8,["href"]),o(P,{disabled:s(r).processing},{default:y(()=>[s(r).processing?(l(),d("span",ve,"Enregistrement...")):(l(),d("span",be,"Enregistrer"))]),_:1},8,["disabled"])])],32)]),_:1})],64))}};export{Ae as default};
