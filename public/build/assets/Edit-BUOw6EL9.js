import{e as L,p as O,c as a,a as y,u as s,h as se,w as $,b as e,q as m,o as l,F as p,r as k,t as c,v as C,d as f,B as x,g as z,f as oe,n as ie,s as ae,k as w,A as I,j as T,G as le}from"./app-B2KrZOCa.js";import{_ as de}from"./AppLayout-CMhKAyAT.js";import{_ as h,a as _}from"./InputError-CsSOzQ1V.js";import{_ as ne}from"./VatScenarioIndicator-CCYKPGG6.js";import"./ApplicationLogo-CBvPJGvQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-Dw9Qk6Ag.js";const ue={class:"flex items-center justify-between"},ge={class:"flex items-center space-x-4"},ce={class:"text-xl font-semibold text-gray-900 dark:text-white"},me={class:"flex items-center space-x-3"},ve=["disabled"],ye={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},be={class:"lg:col-span-2 space-y-6"},xe={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},pe={class:"px-6 py-4"},fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ke=["value"],we={key:0,class:"mt-2"},he={class:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2"},_e={class:"mt-4"},Ce={class:"mt-4"},Ve=["value"],Me={key:0,class:"mt-4"},Ae={class:"mt-4"},Se=["placeholder"],ze={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Fe={class:"mt-4 flex items-center justify-end gap-3"},Ue={key:0,class:"text-sm text-green-600 dark:text-green-400"},je=["disabled"],Te={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Be={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800"},qe={class:"divide-y divide-gray-200 dark:divide-gray-700"},Le={key:0,class:"space-y-3"},$e={class:"grid grid-cols-1 gap-3"},Ie={class:"flex flex-wrap gap-3 items-end"},Ee={class:"w-20"},He={class:"w-28"},Pe=["value"],De={class:"w-28"},Ne={class:"w-28"},Re=["value"],Oe={class:"flex space-x-2"},Qe=["onClick","disabled"],Ge={key:1,class:"flex items-center justify-between"},Je={key:0,class:"flex flex-col mr-3"},Ke=["onClick","disabled"],We=["onClick","disabled"],Xe=["onClick"],Ye={class:"text-sm font-medium text-gray-900 dark:text-white"},Ze={key:0,class:"text-sm text-gray-500 dark:text-gray-400 whitespace-pre-line"},et={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},tt={class:"flex items-center space-x-2"},rt={class:"text-sm font-medium text-gray-900 dark:text-white mr-2"},st=["onClick"],ot=["onClick"],it={class:"space-y-3"},at={class:"grid grid-cols-1 gap-3"},lt={class:"flex flex-wrap gap-3 items-end"},dt={class:"w-20"},nt={class:"w-28"},ut=["value"],gt={class:"w-28"},ct={class:"w-28"},mt=["value"],vt=["disabled"],yt={class:"space-y-6"},bt={class:"overflow-hidden rounded-lg bg-white shadow dark:bg-gray-800 sticky top-20"},xt={class:"px-6 py-4 space-y-3"},pt={class:"flex justify-between text-sm"},ft={class:"font-medium text-gray-900 dark:text-white"},kt={class:"flex justify-between text-sm"},wt={class:"font-medium text-gray-900 dark:text-white"},ht={class:"border-t border-gray-200 dark:border-gray-700 pt-3"},_t={class:"flex justify-between"},Ct={class:"text-lg font-bold text-gray-900 dark:text-white"},Vt={class:"px-6 py-4 bg-gray-50 dark:bg-gray-700/50"},Mt={class:"text-xs text-gray-500 dark:text-gray-400"},At={key:0,class:"fixed inset-0 z-50 overflow-hidden"},St={class:"flex items-center justify-center min-h-screen p-4"},zt={class:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col"},Ft={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Ut={class:"flex items-center space-x-2"},jt=["href"],Tt=["disabled"],Bt={class:"flex-1 overflow-auto p-6 bg-gray-100 dark:bg-gray-900"},qt={key:0,class:"flex items-center justify-center h-96"},Lt=["innerHTML"],$t={class:"flex items-center justify-end px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},It={key:1,class:"fixed inset-0 z-50 overflow-y-auto"},Et={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ht={class:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all dark:bg-gray-800 sm:my-8 sm:w-full sm:max-w-lg sm:align-middle"},Pt={class:"bg-gray-50 px-4 py-3 dark:bg-gray-700 sm:flex sm:flex-row-reverse sm:px-6"},Kt={__name:"Edit",props:{invoice:Object,clients:Array,vatRates:Array,units:Array,isVatExempt:Boolean,defaultInvoiceFooter:String,vatMentionOptions:Array,defaultVatMention:String,defaultCustomVatMention:String,clientVatScenario:Object,suggestedVatMention:String,vatScenarios:Object},setup(v){const g=v,E=g.isVatExempt?0:17,Q=I(()=>{var o;return(o=g.clients)==null?void 0:o.find(t=>t.id===i.client_id)}),H=I(()=>{var o;return((o=Q.value)==null?void 0:o.vat_scenario)||null}),V=w(!1),M=w(!1),B=w(""),A=w(!1),F=w(null),n=L({title:"",description:"",quantity:1,unit:"",unit_price:0,vat_rate:17}),i=L({client_id:g.invoice.client_id,title:g.invoice.title||"",due_at:g.invoice.due_at||"",notes:g.invoice.notes||"",footer_message:g.invoice.footer_message||"",vat_mention:g.invoice.vat_mention||"",custom_vat_mention:g.invoice.custom_vat_mention||"",currency:g.invoice.currency}),u=L({title:"",description:"",quantity:1,unit:"hour",unit_price:0,vat_rate:E}),q=I(()=>{let o=0,t=0;for(const b of g.invoice.items||[])o+=parseFloat(b.total_ht)||0,t+=parseFloat(b.total_vat)||0;return{ht:o,vat:t,ttc:o+t}}),S=o=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:g.invoice.currency||"EUR"}).format(o),P=w(!1),U=w(!1);O(()=>[i.client_id,i.title,i.due_at,i.notes,i.footer_message,i.vat_mention,i.custom_vat_mention],()=>{P.value=!0,U.value=!1},{deep:!0}),O(()=>i.client_id,o=>{var t,b;if(o){const r=(t=g.clients)==null?void 0:t.find(j=>j.id===o);(b=r==null?void 0:r.vat_scenario)!=null&&b.mention&&!i.vat_mention&&(i.vat_mention=r.vat_scenario.mention)}});const G=()=>{i.put(route("invoices.update",g.invoice.id),{preserveScroll:!0,onSuccess:()=>{P.value=!1,U.value=!0,setTimeout(()=>{U.value=!1},2e3)}})},J=()=>{u.post(route("invoices.items.store",g.invoice.id),{preserveScroll:!0,onSuccess:()=>{u.reset(),u.title="",u.description="",u.quantity=1,u.unit="hour",u.vat_rate=E}})},K=(o,t)=>{const b={hour:{singular:"heure",plural:"heures"},day:{singular:"jour",plural:"jours"},piece:{singular:"unité",plural:"unités"},package:{singular:"forfait",plural:"forfaits"},month:{singular:"mois",plural:"mois"},word:{singular:"mot",plural:"mots"},page:{singular:"page",plural:"pages"}};return!o||!b[o]?"":t<=1?b[o].singular:b[o].plural},W=o=>{const t=parseFloat(o);return t===Math.floor(t)?Math.floor(t).toString():t.toFixed(2).replace(/\.?0+$/,"").replace(".",",")},D=(o,t)=>{T.patch(route("invoices.items.move",[g.invoice.id,o]),{direction:t},{preserveScroll:!0})},X=o=>{confirm("Supprimer cette ligne ?")&&T.delete(route("invoices.items.destroy",[g.invoice.id,o]),{preserveScroll:!0})},N=o=>{F.value=o.id,n.title=o.title,n.description=o.description||"",n.quantity=parseFloat(o.quantity),n.unit=o.unit||"",n.unit_price=parseFloat(o.unit_price),n.vat_rate=parseFloat(o.vat_rate)},Y=()=>{F.value=null,n.reset()},Z=o=>{n.put(route("invoices.items.update",[g.invoice.id,o]),{preserveScroll:!0,onSuccess:()=>{F.value=null,n.reset()}})},ee=()=>{confirm("Supprimer ce brouillon ?")&&T.delete(route("invoices.destroy",g.invoice.id))},te=()=>{T.post(route("invoices.finalize",g.invoice.id),{},{onSuccess:()=>{V.value=!1}})},R=async()=>{A.value=!0;try{const o=await le.get(route("invoices.preview-draft",g.invoice.id));B.value=o.data.html}catch(o){console.error("Error loading preview:",o),B.value=`<p style="color: red; padding: 20px;">Erreur lors du chargement de l'aperçu</p>`}finally{A.value=!1}},re=()=>{M.value=!0,R()};return(o,t)=>(l(),a(p,null,[y(s(se),{title:`Facture ${v.invoice.display_number}`},null,8,["title"]),y(de,null,{header:$(()=>[e("div",ue,[e("div",ge,[y(s(ae),{href:o.route("invoices.index"),class:"text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400"},{default:$(()=>[...t[25]||(t[25]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z","clip-rule":"evenodd"})],-1)])]),_:1},8,["href"]),e("h1",ce,c(v.invoice.title||"Facture brouillon"),1),t[26]||(t[26]=e("span",{class:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800 dark:bg-gray-700 dark:text-gray-300"}," Brouillon ",-1))]),e("div",me,[e("button",{type:"button",onClick:re,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"},[...t[27]||(t[27]=[e("svg",{class:"h-4 w-4 mr-1.5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"}),e("path",{"fill-rule":"evenodd",d:"M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),z(" Aperçu ",-1)])]),e("button",{type:"button",onClick:ee,class:"inline-flex items-center rounded-md border border-red-300 bg-white px-3 py-2 text-sm font-medium text-red-700 shadow-sm hover:bg-red-50 dark:border-red-600 dark:bg-gray-700 dark:text-red-400 dark:hover:bg-gray-600"}," Supprimer "),e("button",{type:"button",onClick:t[0]||(t[0]=b=>V.value=!0),disabled:!v.invoice.items||v.invoice.items.length===0,class:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Finaliser ",8,ve)])])]),default:$(()=>{var b;return[e("div",ye,[e("div",be,[e("div",xe,[t[31]||(t[31]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Informations")],-1)),e("div",pe,[e("div",fe,[e("div",null,[y(h,{for:"client_id",value:"Client"}),m(e("select",{id:"client_id","onUpdate:modelValue":t[1]||(t[1]=r=>s(i).client_id=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},[(l(!0),a(p,null,k(v.clients,r=>(l(),a("option",{key:r.id,value:r.id},c(r.name),9,ke))),128))],512),[[C,s(i).client_id]]),y(_,{message:s(i).errors.client_id,class:"mt-2"},null,8,["message"]),H.value?(l(),a("div",we,[y(ne,{scenario:H.value,size:"sm"},null,8,["scenario"])])):f("",!0)]),e("div",null,[y(h,{for:"title",value:"Titre (optionnel)"}),m(e("input",{id:"title","onUpdate:modelValue":t[2]||(t[2]=r=>s(i).title=r),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Ex: Prestation janvier 2026"},null,512),[[x,s(i).title]]),y(_,{message:s(i).errors.title,class:"mt-2"},null,8,["message"])])]),e("div",he,[e("div",null,[y(h,{for:"due_at",value:"Échéance"}),m(e("input",{id:"due_at","onUpdate:modelValue":t[3]||(t[3]=r=>s(i).due_at=r),type:"date",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},null,512),[[x,s(i).due_at]]),y(_,{message:s(i).errors.due_at,class:"mt-2"},null,8,["message"])])]),e("div",_e,[y(h,{for:"notes",value:"Notes"}),m(e("textarea",{id:"notes","onUpdate:modelValue":t[4]||(t[4]=r=>s(i).notes=r),rows:"2",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Notes ou conditions particulières..."},null,512),[[x,s(i).notes]])]),e("div",Ce,[y(h,{for:"vat_mention",value:"Mention TVA (optionnel)"}),m(e("select",{id:"vat_mention","onUpdate:modelValue":t[5]||(t[5]=r=>s(i).vat_mention=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},[t[28]||(t[28]=e("option",{value:""},"Utiliser la mention par défaut",-1)),(l(!0),a(p,null,k(v.vatMentionOptions,r=>(l(),a("option",{key:r.value,value:r.value},c(r.label),9,Ve))),128))],512),[[C,s(i).vat_mention]]),t[29]||(t[29]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Si vide, la mention par défaut des réglages sera utilisée. ",-1))]),s(i).vat_mention==="other"?(l(),a("div",Me,[y(h,{for:"custom_vat_mention",value:"Mention TVA personnalisée"}),m(e("textarea",{id:"custom_vat_mention","onUpdate:modelValue":t[6]||(t[6]=r=>s(i).custom_vat_mention=r),rows:"2",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Saisissez votre mention TVA personnalisée..."},null,512),[[x,s(i).custom_vat_mention]])])):f("",!0),e("div",Ae,[y(h,{for:"footer_message",value:"Message de pied de page (optionnel)"}),m(e("textarea",{id:"footer_message","onUpdate:modelValue":t[7]||(t[7]=r=>s(i).footer_message=r),rows:"2",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:v.defaultInvoiceFooter},null,8,Se),[[x,s(i).footer_message]]),e("p",ze,' Si vide, le message par défaut sera utilisé : "'+c(v.defaultInvoiceFooter)+'" ',1)]),e("div",Fe,[U.value?(l(),a("span",Ue," Enregistré ! ")):f("",!0),e("button",{type:"button",onClick:G,disabled:s(i).processing,class:"inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 disabled:opacity-50"},[s(i).processing?(l(),a("svg",Te,[...t[30]||(t[30]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):f("",!0),z(" "+c(s(i).processing?"Enregistrement...":"Enregistrer"),1)],8,je)])])]),e("div",Be,[t[52]||(t[52]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Lignes de facture")],-1)),e("div",qe,[(l(!0),a(p,null,k(v.invoice.items,(r,j)=>(l(),a("div",{key:r.id,class:"px-6 py-4"},[F.value===r.id?(l(),a("div",Le,[e("div",$e,[e("div",null,[t[32]||(t[32]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Titre",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=d=>s(n).title=d),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Titre de la prestation",required:""},null,512),[[x,s(n).title]]),y(_,{message:s(n).errors.title,class:"mt-1"},null,8,["message"])]),e("div",null,[t[33]||(t[33]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Description (optionnel)",-1)),m(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=d=>s(n).description=d),rows:"2",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Description détaillée"},null,512),[[x,s(n).description]]),y(_,{message:s(n).errors.description,class:"mt-1"},null,8,["message"])])]),e("div",Ie,[e("div",Ee,[t[34]||(t[34]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Quantité",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=d=>s(n).quantity=d),type:"number",step:"0.01",min:"0.01",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",required:""},null,512),[[x,s(n).quantity,void 0,{number:!0}]])]),e("div",He,[t[36]||(t[36]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Unité",-1)),m(e("select",{"onUpdate:modelValue":t[11]||(t[11]=d=>s(n).unit=d),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"},[t[35]||(t[35]=e("option",{value:""},"Sans unité",-1)),(l(!0),a(p,null,k(v.units,d=>(l(),a("option",{key:d.value,value:d.value},c(d.label),9,Pe))),128))],512),[[C,s(n).unit]])]),e("div",De,[t[37]||(t[37]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Prix HT",-1)),m(e("input",{"onUpdate:modelValue":t[12]||(t[12]=d=>s(n).unit_price=d),type:"number",step:"0.01",min:"0",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",required:""},null,512),[[x,s(n).unit_price,void 0,{number:!0}]])]),e("div",Ne,[t[38]||(t[38]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"TVA",-1)),m(e("select",{"onUpdate:modelValue":t[13]||(t[13]=d=>s(n).vat_rate=d),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"},[(l(!0),a(p,null,k(v.vatRates,d=>(l(),a("option",{key:d.value,value:d.value},c(d.value)+"% ",9,Re))),128))],512),[[C,s(n).vat_rate,void 0,{number:!0}]])]),e("div",Oe,[e("button",{type:"button",onClick:d=>Z(r.id),disabled:s(n).processing,class:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 disabled:opacity-50"},[...t[39]||(t[39]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z","clip-rule":"evenodd"})],-1)])],8,Qe),e("button",{type:"button",onClick:Y,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300"},[...t[40]||(t[40]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})],-1)])])])])])):(l(),a("div",Ge,[v.invoice.items.length>1?(l(),a("div",Je,[e("button",{type:"button",onClick:d=>D(r.id,"up"),disabled:j===0,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Monter"},[...t[41]||(t[41]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832 6.29 12.77a.75.75 0 11-1.08-1.04l4.25-4.5a.75.75 0 011.08 0l4.25 4.5a.75.75 0 01-.02 1.06z","clip-rule":"evenodd"})],-1)])],8,Ke),e("button",{type:"button",onClick:d=>D(r.id,"down"),disabled:j===v.invoice.items.length-1,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",title:"Descendre"},[...t[42]||(t[42]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"})],-1)])],8,We)])):f("",!0),e("div",{class:"flex-1 cursor-pointer",onClick:d=>N(r)},[e("p",Ye,c(r.title),1),r.description?(l(),a("p",Ze,c(r.description),1)):f("",!0),e("p",et,c(W(r.quantity))+" "+c(K(r.unit,r.quantity))+" x "+c(S(r.unit_price))+" (TVA "+c(r.vat_rate)+"%) ",1)],8,Xe),e("div",tt,[e("span",rt,c(S(r.total_ht)),1),e("button",{type:"button",onClick:d=>N(r),class:"p-1 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400",title:"Modifier"},[...t[43]||(t[43]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M2.695 14.763l-1.262 3.154a.5.5 0 00.65.65l3.155-1.262a4 4 0 001.343-.885L17.5 5.5a2.121 2.121 0 00-3-3L3.58 13.42a4 4 0 00-.885 1.343z"})],-1)])],8,st),e("button",{type:"button",onClick:d=>X(r.id),class:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400",title:"Supprimer"},[...t[44]||(t[44]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.519.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5z","clip-rule":"evenodd"})],-1)])],8,ot)])]))]))),128)),e("form",{onSubmit:oe(J,["prevent"]),class:"px-6 py-4"},[t[51]||(t[51]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"Ajouter une ligne",-1)),e("div",it,[e("div",at,[e("div",null,[m(e("input",{"onUpdate:modelValue":t[14]||(t[14]=r=>s(u).title=r),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Titre de la prestation",required:""},null,512),[[x,s(u).title]]),y(_,{message:s(u).errors.title,class:"mt-1"},null,8,["message"])]),e("div",null,[m(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=r=>s(u).description=r),rows:"2",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Description détaillée (optionnel)"},null,512),[[x,s(u).description]]),y(_,{message:s(u).errors.description,class:"mt-1"},null,8,["message"])])]),e("div",lt,[e("div",dt,[t[45]||(t[45]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Quantité",-1)),m(e("input",{"onUpdate:modelValue":t[16]||(t[16]=r=>s(u).quantity=r),type:"number",step:"0.01",min:"0.01",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",required:""},null,512),[[x,s(u).quantity,void 0,{number:!0}]])]),e("div",nt,[t[47]||(t[47]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Unité",-1)),m(e("select",{"onUpdate:modelValue":t[17]||(t[17]=r=>s(u).unit=r),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"},[t[46]||(t[46]=e("option",{value:""},"Sans unité",-1)),(l(!0),a(p,null,k(v.units,r=>(l(),a("option",{key:r.value,value:r.value},c(r.label),9,ut))),128))],512),[[C,s(u).unit]])]),e("div",gt,[t[48]||(t[48]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Prix HT",-1)),m(e("input",{"onUpdate:modelValue":t[18]||(t[18]=r=>s(u).unit_price=r),type:"number",step:"0.01",min:"0",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",required:""},null,512),[[x,s(u).unit_price,void 0,{number:!0}]])]),e("div",ct,[t[49]||(t[49]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"TVA",-1)),m(e("select",{"onUpdate:modelValue":t[19]||(t[19]=r=>s(u).vat_rate=r),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"},[(l(!0),a(p,null,k(v.vatRates,r=>(l(),a("option",{key:r.value,value:r.value},c(r.value)+"% ",9,mt))),128))],512),[[C,s(u).vat_rate,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:s(u).processing,class:"inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 disabled:opacity-50"},[...t[50]||(t[50]=[e("svg",{class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})],-1),z(" Ajouter ",-1)])],8,vt)])])],32)])])]),e("div",yt,[e("div",bt,[t[56]||(t[56]=e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Résumé")],-1)),e("div",xt,[e("div",pt,[t[53]||(t[53]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Total HT",-1)),e("span",ft,c(S(q.value.ht)),1)]),e("div",kt,[t[54]||(t[54]=e("span",{class:"text-gray-500 dark:text-gray-400"},"TVA",-1)),e("span",wt,c(S(q.value.vat)),1)]),e("div",ht,[e("div",_t,[t[55]||(t[55]=e("span",{class:"text-base font-medium text-gray-900 dark:text-white"},"Total TTC",-1)),e("span",Ct,c(S(q.value.ttc)),1)])])]),e("div",Vt,[e("p",Mt,c(((b=v.invoice.items)==null?void 0:b.length)||0)+" ligne(s) ",1)])])])]),M.value?(l(),a("div",At,[e("div",St,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:t[20]||(t[20]=r=>M.value=!1)}),e("div",zt,[e("div",Ft,[t[61]||(t[61]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Aperçu de la facture ",-1)),e("div",Ut,[e("a",{href:o.route("invoices.draft-pdf",v.invoice.id),target:"_blank",class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300"},[...t[57]||(t[57]=[e("svg",{class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z"}),e("path",{d:"M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z"})],-1),z(" PDF ",-1)])],8,jt),e("button",{type:"button",onClick:R,disabled:A.value,class:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 disabled:opacity-50"},[(l(),a("svg",{class:ie(["h-4 w-4 mr-1",{"animate-spin":A.value}]),viewBox:"0 0 20 20",fill:"currentColor"},[...t[58]||(t[58]=[e("path",{"fill-rule":"evenodd",d:"M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z","clip-rule":"evenodd"},null,-1)])],2)),t[59]||(t[59]=z(" Actualiser ",-1))],8,Tt),e("button",{type:"button",onClick:t[21]||(t[21]=r=>M.value=!1),class:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"},[...t[60]||(t[60]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Bt,[A.value?(l(),a("div",qt,[...t[62]||(t[62]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)])])):(l(),a("div",{key:1,class:"bg-white shadow-lg mx-auto",style:{width:"210mm","min-height":"297mm","transform-origin":"top center"},innerHTML:B.value},null,8,Lt))]),e("div",$t,[t[63]||(t[63]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mr-auto"}," Ceci est un aperçu. Finalisez la facture pour générer le PDF final. ",-1)),e("button",{type:"button",onClick:t[22]||(t[22]=r=>M.value=!1),class:"inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-600 dark:text-white dark:ring-gray-500"}," Fermer ")])])])])):f("",!0),V.value?(l(),a("div",It,[e("div",Et,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:t[23]||(t[23]=r=>V.value=!1)}),e("div",Ht,[t[64]||(t[64]=e("div",{class:"px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},[e("div",{class:"sm:flex sm:items-start"},[e("div",{class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("div",{class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900 dark:text-white"}," Finaliser la facture ? "),e("div",{class:"mt-2"},[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Une fois finalisée, la facture sera verrouillée et ne pourra plus être modifiée. Un numéro de facture sera automatiquement attribué. ")])])])],-1)),e("div",Pt,[e("button",{type:"button",onClick:te,class:"inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:ml-3 sm:w-auto"}," Finaliser "),e("button",{type:"button",onClick:t[24]||(t[24]=r=>V.value=!1),class:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-600 dark:text-white dark:ring-gray-500 sm:mt-0 sm:w-auto"}," Annuler ")])])])])):f("",!0)]}),_:1})],64))}};export{Kt as default};
