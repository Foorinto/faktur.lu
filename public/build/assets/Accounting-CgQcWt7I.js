import{u as Q,y as X,r as f,c as r,a as N,b as s,h as q,i as z,d as t,t as o,w as G,o as i,F as g,j as h,f as x,v as p,x as $,J as W,s as Z,g as m,e as I,p as tt}from"./app-BM4k7HEV.js";import{_ as et}from"./AppLayout-S94i9LSh.js";import{u as st}from"./useTranslations-BUq1IIhi.js";import"./DropdownLink-4RKVfM9H.js";const ot={class:"text-xl font-semibold text-slate-900 dark:text-white"},lt={class:"py-6"},at={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},dt={class:"bg-white dark:bg-slate-800 shadow rounded-2xl p-6"},rt={class:"text-lg font-medium text-slate-900 dark:text-white mb-4"},it={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},ct={class:"flex flex-wrap gap-2 mb-3"},ut=["onClick"],_t={class:"flex flex-wrap gap-2 mb-3"},xt=["onClick"],vt={class:"grid grid-cols-2 gap-4"},pt={class:"block text-xs text-slate-500 dark:text-slate-400 mb-1"},bt={class:"block text-xs text-slate-500 dark:text-slate-400 mb-1"},ft={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},mt={class:"space-y-2"},gt=["value"],ht={class:"ml-3 text-sm text-slate-700 dark:text-slate-300"},kt={class:"flex items-center"},wt={class:"ml-2 text-sm text-slate-700 dark:text-slate-300"},yt={key:0,class:"rounded-2xl bg-slate-50 dark:bg-slate-700 p-4"},Ct={class:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-3"},jt={key:0,class:"flex items-center justify-center py-4"},St={key:1,class:"space-y-2"},Vt={class:"flex justify-between text-sm"},$t={class:"text-slate-600 dark:text-slate-400"},Mt={class:"font-medium text-slate-900 dark:text-white"},Ut={key:0,class:"flex justify-between text-sm"},Tt={class:"text-slate-600 dark:text-slate-400"},At={class:"font-medium text-slate-900 dark:text-white"},Bt={class:"flex justify-between text-sm pt-2 border-t border-slate-200 dark:border-slate-600"},Ft={class:"text-slate-600 dark:text-slate-400"},Dt={class:"font-medium text-slate-900 dark:text-white"},Nt={class:"flex justify-between text-sm"},zt={class:"text-slate-600 dark:text-slate-400"},Et={class:"font-medium text-slate-900 dark:text-white"},Lt={class:"flex justify-between text-sm"},Rt={class:"text-slate-600 dark:text-slate-400"},Yt={class:"font-medium text-slate-900 dark:text-white"},Ot={class:"flex justify-end gap-3"},Pt=["disabled"],Ht={key:0},Jt={key:1},Kt=["disabled"],Qt={key:0},Xt={key:1},qt={class:"space-y-6"},Gt={class:"bg-white dark:bg-slate-800 shadow rounded-2xl p-6"},Wt={class:"text-lg font-medium text-slate-900 dark:text-white mb-4"},Zt={key:0,class:"text-center py-8 text-slate-500 dark:text-slate-400"},It={key:1,class:"space-y-3"},te={class:"flex-1 min-w-0"},ee={class:"flex items-center gap-2"},se={class:"text-sm font-medium text-slate-900 dark:text-white"},oe={class:"mt-1 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400"},le={key:0},ae={class:"flex items-center gap-2 ml-4"},ne=["onClick"],de=["onClick"],re={class:"bg-white dark:bg-slate-800 shadow rounded-2xl p-6"},ie={key:0,class:"mt-4 space-y-4"},ce={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},ue={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},_e={class:"grid grid-cols-2 gap-3"},xe={class:"block text-xs text-slate-500 dark:text-slate-400 mb-1"},ve=["onUpdate:modelValue"],pe={class:"grid grid-cols-2 gap-4"},be={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},fe={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},me={class:"grid grid-cols-2 gap-4"},ge={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},he={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},ke={class:"flex items-center justify-end gap-3 pt-2"},we={key:0,class:"text-sm text-green-600 dark:text-green-400"},ye=["disabled"],Ce={class:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-4"},je={class:"flex"},Se={class:"ml-3"},Ve={class:"text-sm font-medium text-blue-800 dark:text-blue-300"},$e={class:"mt-1 text-sm text-blue-700 dark:text-blue-400"},Be={__name:"Accounting",props:{exports:Array,years:Array,formats:Object,defaultYear:Number,accountingSettings:Object},setup(b){var U,T,A,B,F,D;const{t:l}=st(),v=b,n=Q({period_start:`${v.defaultYear}-01-01`,period_end:`${v.defaultYear}-12-31`,format:"generic",include_credit_notes:!0}),c=f(null),k=f(!1),E=async()=>{k.value=!0;try{const d=await fetch(route("exports.accounting.preview",{period_start:n.period_start,period_end:n.period_end,include_credit_notes:n.include_credit_notes}));d.ok&&(c.value=await d.json())}catch{c.value=null}finally{k.value=!1}};X([()=>n.period_start,()=>n.period_end,()=>n.include_credit_notes],()=>{n.period_start&&n.period_end&&E()},{immediate:!0});const L=d=>{n.period_start=`${d}-01-01`,n.period_end=`${d}-12-31`},R=(d,a)=>{const e=(a-1)*3+1,_=e+2,V=new Date(d,_,0).getDate();n.period_start=`${d}-${String(e).padStart(2,"0")}-01`,n.period_end=`${d}-${String(_).padStart(2,"0")}-${V}`},u=f({sales_account:((U=v.accountingSettings)==null?void 0:U.sales_account)??"702000",vat_collected_accounts:((T=v.accountingSettings)==null?void 0:T.vat_collected_accounts)??{17:"461100",14:"461400",8:"461800",3:"461300"},clients_account:((A=v.accountingSettings)==null?void 0:A.clients_account)??"411000",bank_account:((B=v.accountingSettings)==null?void 0:B.bank_account)??"512000",sales_journal:((F=v.accountingSettings)==null?void 0:F.sales_journal)??"VE",client_prefix:((D=v.accountingSettings)==null?void 0:D.client_prefix)??"C"}),w=f(!1),y=f(!1),C=f(!1),Y=async()=>{var d;w.value=!0,y.value=!1;try{(await fetch(route("settings.accounting.update"),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content},body:JSON.stringify(u.value)})).ok&&(y.value=!0,setTimeout(()=>y.value=!1,3e3))}catch{}finally{w.value=!1}},S=d=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(d),O=d=>d?new Date(d).toLocaleString("fr-FR"):"-",P=()=>{n.post(route("exports.accounting.store"))},j=f(!1),H=()=>{if(!n.period_start||!n.period_end)return;j.value=!0;const d=new URLSearchParams({period_start:n.period_start,period_end:n.period_end,include_credit_notes:n.include_credit_notes?"1":"0"});window.location.href=route("exports.accounting.pdf-archive")+"?"+d.toString(),setTimeout(()=>j.value=!1,3e3)},J=d=>{window.location.href=route("exports.accounting.download",d.id)},K=d=>{confirm(l("delete_confirm"))&&tt.delete(route("exports.accounting.destroy",d.id))},M=d=>{switch(d){case"completed":return{class:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",text:l("completed")};case"processing":return{class:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",text:l("processing")};case"failed":return{class:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",text:l("failed")};default:return{class:"bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-300",text:l("pending")}}};return(d,a)=>(i(),r(g,null,[N(s(q),{title:s(l)("accounting_export")},null,8,["title"]),N(et,null,{header:z(()=>[t("h1",ot,o(s(l)("accounting_export")),1)]),default:z(()=>[t("div",lt,[t("div",at,[t("div",nt,[t("div",dt,[t("h2",rt,o(s(l)("new_export")),1),t("form",{onSubmit:G(P,["prevent"]),class:"space-y-6"},[t("div",null,[t("label",it,o(s(l)("period")),1),t("div",ct,[(i(!0),r(g,null,h(b.years,e=>(i(),r("button",{key:e,type:"button",onClick:_=>L(e),class:"px-3 py-1 text-sm rounded-full border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300"},o(e),9,ut))),128))]),t("div",_t,[(i(),r(g,null,h([1,2,3,4],e=>t("button",{key:`q${e}`,type:"button",onClick:_=>R(b.defaultYear,e),class:"px-3 py-1 text-sm rounded-full border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300"}," T"+o(e)+" "+o(b.defaultYear),9,xt)),64))]),t("div",vt,[t("div",null,[t("label",pt,o(s(l)("from")),1),x(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>s(n).period_start=e),type:"date",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[p,s(n).period_start]])]),t("div",null,[t("label",bt,o(s(l)("to")),1),x(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>s(n).period_end=e),type:"date",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[p,s(n).period_end]])])])]),t("div",null,[t("label",ft,o(s(l)("format")),1),t("div",mt,[(i(!0),r(g,null,h(b.formats,(e,_)=>(i(),r("label",{key:_,class:$(["flex items-center p-3 border rounded-2xl cursor-pointer transition-colors",s(n).format===_?"border-violet-500 bg-violet-50 dark:bg-violet-900/20":"border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"])},[x(t("input",{"onUpdate:modelValue":a[2]||(a[2]=V=>s(n).format=V),value:_,type:"radio",class:"h-4 w-4 text-violet-600 focus:ring-violet-500"},null,8,gt),[[W,s(n).format]]),t("span",ht,o(e),1)],2))),128))])]),t("div",null,[t("label",kt,[x(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>s(n).include_credit_notes=e),type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-slate-300 dark:border-slate-600"},null,512),[[Z,s(n).include_credit_notes]]),t("span",wt,o(s(l)("include_credit_notes")),1)])]),c.value||k.value?(i(),r("div",yt,[t("h3",Ct,o(s(l)("preview")),1),k.value?(i(),r("div",jt,[...a[10]||(a[10]=[t("svg",{class:"animate-spin h-5 w-5 text-violet-500",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):c.value?(i(),r("div",St,[t("div",Vt,[t("span",$t,o(s(l)("invoices")),1),t("span",Mt,o(c.value.invoices_count),1)]),s(n).include_credit_notes?(i(),r("div",Ut,[t("span",Tt,o(s(l)("credit_notes")),1),t("span",At,o(c.value.credit_notes_count),1)])):m("",!0),t("div",Bt,[t("span",Ft,o(s(l)("total_ht")),1),t("span",Dt,o(S(c.value.total_ht)),1)]),t("div",Nt,[t("span",zt,o(s(l)("total_vat")),1),t("span",Et,o(S(c.value.total_vat)),1)]),t("div",Lt,[t("span",Rt,o(s(l)("total_ttc")),1),t("span",Yt,o(S(c.value.total_ttc)),1)])])):m("",!0)])):m("",!0),t("div",Ot,[t("button",{type:"button",onClick:H,disabled:j.value||!c.value||c.value.invoices_count===0&&c.value.credit_notes_count===0,class:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-2xl hover:bg-slate-100 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2"},[a[11]||(a[11]=t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1)),j.value?(i(),r("span",Ht,o(s(l)("generating"))+"...",1)):(i(),r("span",Jt,"Archive PDF"))],8,Pt),t("button",{type:"submit",disabled:s(n).processing||!c.value||c.value.invoices_count===0&&c.value.credit_notes_count===0,class:"px-4 py-2 bg-violet-600 text-white rounded-2xl hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[s(n).processing?(i(),r("span",Qt,o(s(l)("generating"))+"...",1)):(i(),r("span",Xt,o(s(l)("generate_export")),1))],8,Kt)])],32)]),t("div",qt,[t("div",Gt,[t("h2",Wt,o(s(l)("export_history")),1),b.exports.length===0?(i(),r("div",Zt,o(s(l)("no_exports_yet")),1)):(i(),r("div",It,[(i(!0),r(g,null,h(b.exports,e=>(i(),r("div",{key:e.id,class:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700 rounded-2xl"},[t("div",te,[t("div",ee,[t("span",se,o(e.period_label),1),t("span",{class:$(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",M(e.status).class])},o(M(e.status).text),3)]),t("div",oe,[t("span",null,o(e.format_label),1),e.documents_count?(i(),r("span",le,o(e.documents_count)+" docs",1)):m("",!0),t("span",null,o(O(e.created_at)),1)])]),t("div",ae,[e.status==="completed"?(i(),r("button",{key:0,onClick:_=>J(e),class:"p-2 text-violet-600 hover:bg-violet-100 dark:hover:bg-violet-900/30 rounded-2xl"},[...a[12]||(a[12]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,ne)):m("",!0),t("button",{onClick:_=>K(e),class:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-2xl"},[...a[13]||(a[13]=[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,de)])]))),128))]))]),t("div",re,[t("button",{onClick:a[4]||(a[4]=e=>C.value=!C.value),class:"w-full flex items-center justify-between text-lg font-medium text-slate-900 dark:text-white"},[I(o(s(l)("accounting_settings"))+" ",1),(i(),r("svg",{class:$(["h-5 w-5 transition-transform",C.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[14]||(a[14]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),C.value?(i(),r("div",ie,[t("div",null,[t("label",ce,o(s(l)("sales_account")),1),x(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>u.value.sales_account=e),type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500",placeholder:"702000"},null,512),[[p,u.value.sales_account]])]),t("div",null,[t("label",ue,o(s(l)("vat_collected_accounts")),1),t("div",_e,[(i(),r(g,null,h(["17","14","8","3"],e=>t("div",{key:e},[t("label",xe,"TVA "+o(e)+"%",1),x(t("input",{"onUpdate:modelValue":_=>u.value.vat_collected_accounts[e]=_,type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500 text-sm"},null,8,ve),[[p,u.value.vat_collected_accounts[e]]])])),64))])]),t("div",pe,[t("div",null,[t("label",be,o(s(l)("clients_account")),1),x(t("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>u.value.clients_account=e),type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500",placeholder:"411000"},null,512),[[p,u.value.clients_account]])]),t("div",null,[t("label",fe,o(s(l)("bank_account")),1),x(t("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>u.value.bank_account=e),type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500",placeholder:"512000"},null,512),[[p,u.value.bank_account]])])]),t("div",me,[t("div",null,[t("label",ge,o(s(l)("sales_journal")),1),x(t("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>u.value.sales_journal=e),type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500",placeholder:"VE"},null,512),[[p,u.value.sales_journal]])]),t("div",null,[t("label",he,o(s(l)("client_prefix")),1),x(t("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>u.value.client_prefix=e),type:"text",class:"w-full rounded-xl border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500",placeholder:"C"},null,512),[[p,u.value.client_prefix]])])]),t("div",ke,[y.value?(i(),r("span",we,o(s(l)("saved")),1)):m("",!0),t("button",{onClick:Y,disabled:w.value,class:"px-4 py-2 bg-violet-600 text-white text-sm rounded-2xl hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 disabled:opacity-50"},o(w.value?s(l)("saving")+"...":s(l)("save")),9,ye)])])):m("",!0)])])]),t("div",Ce,[t("div",je,[a[15]||(a[15]=t("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",Se,[t("h3",Ve,o(s(l)("accounting_export")),1),t("p",$e,o(s(l)("accounting_export_description")),1)])])])])])]),_:1})],64))}};export{Be as default};
