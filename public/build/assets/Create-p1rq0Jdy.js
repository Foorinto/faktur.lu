import{u as I,y as T,c as u,a as n,b as a,h as B,i as k,d as e,w as N,f as v,t as m,o as c,F as h,j as g,k as V,v as f,g as w,e as $,l as E,r as L,B as M}from"./app-Bn0xusA4.js";import{_ as D}from"./AppLayout-BuT35Jat.js";import{_ as C}from"./InputError-CELf2cZ8.js";import{_}from"./InputLabel-tdoclgSa.js";import{_ as z}from"./PrimaryButton-BOCnbG9p.js";import{u as H}from"./useTranslations-B-jVHMSX.js";import"./DropdownLink-DiFQEvSg.js";const Q={class:"flex items-center space-x-4"},O={class:"text-xl font-semibold text-slate-900 dark:text-white"},P={class:"overflow-hidden rounded-2xl bg-white shadow dark:bg-slate-800"},j={class:"px-6 py-4"},G={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},K={value:""},Y=["value"],Z={class:"mt-1 text-xs text-slate-500 dark:text-slate-400"},J={class:"overflow-hidden rounded-2xl bg-white shadow dark:bg-slate-800"},W={class:"px-6 py-4 border-b border-slate-200 dark:border-slate-700"},X={class:"text-lg font-medium text-slate-900 dark:text-white"},ee={class:"px-6 py-4"},te={class:"space-y-4"},ae={class:"space-y-3"},se={class:"flex-1"},le=["id","onUpdate:modelValue","placeholder"],re={class:"flex-1"},oe=["id","onUpdate:modelValue","placeholder"],de={class:"flex flex-wrap gap-4 items-end"},ie={class:"w-24"},ne=["id","onUpdate:modelValue"],ue={class:"w-32"},ce=["id","onUpdate:modelValue"],me=["value"],_e={class:"w-32"},ve=["id","onUpdate:modelValue"],pe={class:"w-32"},fe=["id","value","onChange"],be=["value"],he={key:1,class:"mt-1 block w-full rounded-xl border border-slate-300 bg-slate-100 px-3 py-2 text-slate-500 dark:border-slate-600 dark:bg-slate-600 dark:text-slate-400"},ke={key:0,class:"w-24"},ge=["id","value","onInput"],xe=["onClick"],we={class:"overflow-hidden rounded-2xl bg-white shadow dark:bg-slate-800"},ye={class:"px-6 py-4 border-b border-slate-200 dark:border-slate-700"},Ve={class:"text-lg font-medium text-slate-900 dark:text-white"},Ce={class:"px-6 py-4 space-y-4"},Ue=["placeholder"],qe=["value"],$e={key:0},Ee=["placeholder"],Me={key:0,class:"mt-1 text-xs text-slate-500 dark:text-slate-400"},Fe={class:"flex justify-end space-x-3"},Re={key:0},Ae={key:1},ze={__name:"Create",props:{clients:Array,vatRates:Array,units:Array,defaultClientId:[String,Number],isVatExempt:Boolean,defaultVatRate:{type:Number,default:17},vatMentionOptions:Array,defaultVatMention:String,suggestedVatMention:String,defaultQuoteFooter:String},setup(p){const{t:i}=H(),b=p,y=M(()=>{var r;return(r=b.clients)==null?void 0:r.find(t=>t.id===l.client_id)}),U=M(()=>{var r,t;return b.isVatExempt?0:((r=y.value)==null?void 0:r.default_vat_rate)!==null&&((t=y.value)==null?void 0:t.default_vat_rate)!==void 0?parseFloat(y.value.default_vat_rate):b.defaultVatRate}),l=I({client_id:b.defaultClientId||"",valid_until:"",notes:"",currency:"EUR",vat_mention:b.suggestedVatMention||"",custom_vat_mention:"",footer_message:"",items:[]}),x=L({}),q=()=>{const r=l.items.length;l.items.push({title:"",description:"",quantity:1,unit:"hour",unit_price:0,vat_rate:U.value,vat_rate_select:U.value}),x.value[r]=""},F=(r,t)=>{t==="custom"?(l.items[r].vat_rate_select="custom",l.items[r].vat_rate=x.value[r]||0):(l.items[r].vat_rate_select=t,l.items[r].vat_rate=t)},R=(r,t)=>{x.value[r]=t,l.items[r].vat_rate_select==="custom"&&(l.items[r].vat_rate=parseFloat(t)||0)};T(()=>l.client_id,r=>{if(r){const t=b.clients.find(s=>s.id===r);if((t==null?void 0:t.default_vat_rate)!==null&&(t==null?void 0:t.default_vat_rate)!==void 0&&l.items.forEach(s=>{if(s.vat_rate_select!=="custom"){const d=parseFloat(t.default_vat_rate);s.vat_rate=d,s.vat_rate_select=d}}),!l.vat_mention&&t){const s=t.country_code&&t.country_code!=="LU"&&["AT","BE","BG","CY","CZ","DE","DK","EE","ES","FI","FR","GR","HR","HU","IE","IT","LT","LV","MT","NL","PL","PT","RO","SE","SI","SK"].includes(t.country_code);t.type==="b2b"&&t.vat_number&&s&&(l.vat_mention="reverse_charge")}}});const A=r=>{l.items.splice(r,1)},S=()=>{l.post(route("quotes.store"))};return l.items.length===0&&q(),(r,t)=>(c(),u(h,null,[n(a(B),{title:a(i)("new_quote")},null,8,["title"]),n(D,null,{header:k(()=>[e("div",Q,[n(a(E),{href:r.route("quotes.index"),class:"text-slate-400 hover:text-slate-500 dark:text-slate-500 dark:hover:text-slate-400"},{default:k(()=>[...t[6]||(t[6]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z","clip-rule":"evenodd"})],-1)])]),_:1},8,["href"]),e("h1",O,m(a(i)("new_quote")),1)])]),default:k(()=>[e("form",{onSubmit:N(S,["prevent"]),class:"space-y-6"},[e("div",P,[t[7]||(t[7]=e("div",{class:"px-6 py-4 border-b border-slate-200 dark:border-slate-700"},[e("h2",{class:"text-lg font-medium text-slate-900 dark:text-white"},"Client")],-1)),e("div",j,[e("div",G,[e("div",null,[n(_,{for:"client_id",value:"Client"}),v(e("select",{id:"client_id","onUpdate:modelValue":t[0]||(t[0]=s=>a(l).client_id=s),class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",required:""},[e("option",K,m(a(i)("select_client")),1),(c(!0),u(h,null,g(p.clients,s=>(c(),u("option",{key:s.id,value:s.id},m(s.name),9,Y))),128))],512),[[V,a(l).client_id]]),n(C,{message:a(l).errors.client_id,class:"mt-2"},null,8,["message"])]),e("div",null,[n(_,{for:"valid_until",value:a(i)("valid_until_optional")},null,8,["value"]),v(e("input",{id:"valid_until","onUpdate:modelValue":t[1]||(t[1]=s=>a(l).valid_until=s),type:"date",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"},null,512),[[f,a(l).valid_until]]),e("p",Z,m(a(i)("default_30_days")),1),n(C,{message:a(l).errors.valid_until,class:"mt-2"},null,8,["message"])])])])]),e("div",J,[e("div",W,[e("h2",X,m(a(i)("quote_lines")),1)]),e("div",ee,[e("div",te,[(c(!0),u(h,null,g(a(l).items,(s,d)=>(c(),u("div",{key:d,class:"p-4 rounded-2xl border border-slate-200 dark:border-slate-700"},[e("div",ae,[e("div",se,[n(_,{for:`item-${d}-title`,value:a(i)("title")},null,8,["for","value"]),v(e("input",{id:`item-${d}-title`,"onUpdate:modelValue":o=>s.title=o,type:"text",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:a(i)("service_title_placeholder"),required:""},null,8,le),[[f,s.title]])]),e("div",re,[n(_,{for:`item-${d}-description`,value:a(i)("description_optional")},null,8,["for","value"]),v(e("textarea",{id:`item-${d}-description`,"onUpdate:modelValue":o=>s.description=o,rows:"2",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:a(i)("detailed_description_placeholder")},null,8,oe),[[f,s.description]])]),e("div",de,[e("div",ie,[n(_,{for:`item-${d}-quantity`,value:a(i)("qty")},null,8,["for","value"]),v(e("input",{id:`item-${d}-quantity`,"onUpdate:modelValue":o=>s.quantity=o,type:"number",step:"0.01",min:"0.01",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",required:""},null,8,ne),[[f,s.quantity,void 0,{number:!0}]])]),e("div",ue,[n(_,{for:`item-${d}-unit`,value:a(i)("unit")},null,8,["for","value"]),v(e("select",{id:`item-${d}-unit`,"onUpdate:modelValue":o=>s.unit=o,class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"},[t[8]||(t[8]=e("option",{value:""},"-",-1)),(c(!0),u(h,null,g(p.units,o=>(c(),u("option",{key:o.value,value:o.value},m(o.label),9,me))),128))],8,ce),[[V,s.unit]])]),e("div",_e,[n(_,{for:`item-${d}-unit_price`,value:a(i)("price_ht")},null,8,["for","value"]),v(e("input",{id:`item-${d}-unit_price`,"onUpdate:modelValue":o=>s.unit_price=o,type:"number",step:"0.01",min:"0",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",required:""},null,8,ve),[[f,s.unit_price,void 0,{number:!0}]])]),e("div",pe,[n(_,{for:`item-${d}-vat_rate`,value:a(i)("vat")},null,8,["for","value"]),p.isVatExempt?(c(),u("div",he,m(a(i)("vat_rates.exempt")),1)):(c(),u("select",{key:0,id:`item-${d}-vat_rate`,value:s.vat_rate_select??s.vat_rate,onChange:o=>F(d,o.target.value==="custom"?"custom":parseFloat(o.target.value)),class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",required:""},[(c(!0),u(h,null,g(p.vatRates,o=>(c(),u("option",{key:o.value,value:o.value},m(o.label),9,be))),128))],40,fe))]),s.vat_rate_select==="custom"&&!p.isVatExempt?(c(),u("div",ke,[n(_,{for:`item-${d}-custom_vat_rate`,value:"%"},null,8,["for"]),e("input",{id:`item-${d}-custom_vat_rate`,type:"number",step:"0.01",min:"0",max:"100",value:x.value[d],onInput:o=>R(d,o.target.value),class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:"Ex: 12"},null,40,ge)])):w("",!0),a(l).items.length>1?(c(),u("button",{key:1,type:"button",onClick:o=>A(d),class:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300"},[...t[9]||(t[9]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.519.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5z","clip-rule":"evenodd"})],-1)])],8,xe)):w("",!0)])])]))),128)),e("button",{type:"button",onClick:q,class:"inline-flex items-center rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600"},[t[10]||(t[10]=e("svg",{class:"-ml-0.5 mr-1.5 h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})],-1)),$(" "+m(a(i)("add_line")),1)])])])]),e("div",we,[e("div",ye,[e("h2",Ve,m(a(i)("notes_optional")),1)]),e("div",Ce,[e("div",null,[n(_,{for:"notes",value:"Notes / Conditions"}),v(e("textarea",{id:"notes","onUpdate:modelValue":t[2]||(t[2]=s=>a(l).notes=s),rows:"3",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:a(i)("special_conditions")},null,8,Ue),[[f,a(l).notes]]),n(C,{message:a(l).errors.notes,class:"mt-2"},null,8,["message"])]),e("div",null,[n(_,{for:"vat_mention",value:"Mention TVA (optionnel)"}),v(e("select",{id:"vat_mention","onUpdate:modelValue":t[3]||(t[3]=s=>a(l).vat_mention=s),class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white"},[t[11]||(t[11]=e("option",{value:""},"Mention par défaut",-1)),(c(!0),u(h,null,g(p.vatMentionOptions,s=>(c(),u("option",{key:s.value,value:s.value},m(s.label),9,qe))),128))],512),[[V,a(l).vat_mention]]),t[12]||(t[12]=e("p",{class:"mt-1 text-xs text-slate-500 dark:text-slate-400"}," Cette mention apparaîtra sur le PDF du devis. ",-1))]),a(l).vat_mention==="other"?(c(),u("div",$e,[n(_,{for:"custom_vat_mention",value:"Mention TVA personnalisée"}),v(e("textarea",{id:"custom_vat_mention","onUpdate:modelValue":t[4]||(t[4]=s=>a(l).custom_vat_mention=s),rows:"2",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:"Entrez votre mention TVA personnalisée..."},null,512),[[f,a(l).custom_vat_mention]])])):w("",!0),e("div",null,[n(_,{for:"footer_message",value:"Message de pied de page (optionnel)"}),v(e("textarea",{id:"footer_message","onUpdate:modelValue":t[5]||(t[5]=s=>a(l).footer_message=s),rows:"2",class:"mt-1 block w-full rounded-xl border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white",placeholder:p.defaultQuoteFooter},null,8,Ee),[[f,a(l).footer_message]]),p.defaultQuoteFooter?(c(),u("p",Me,' Si vide, le message par défaut sera utilisé : "'+m(p.defaultQuoteFooter)+'" ',1)):w("",!0)])])]),e("div",Fe,[n(a(E),{href:r.route("quotes.index"),class:"inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600"},{default:k(()=>[$(m(a(i)("cancel")),1)]),_:1},8,["href"]),n(z,{disabled:a(l).processing},{default:k(()=>[a(l).processing?(c(),u("span",Re,m(a(i)("creating")),1)):(c(),u("span",Ae,m(a(i)("create_quote")),1))]),_:1},8,["disabled"])])],32)]),_:1})],64))}};export{ze as default};
