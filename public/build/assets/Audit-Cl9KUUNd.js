import{u as A,z as L,c as l,a as C,b as t,h as T,i as $,d as e,t as s,w as H,o as i,F as x,j as f,f as v,v as z,x as M,C as R,s as j,g,e as V,r as h,p as O}from"./app-B97I2Oxk.js";import{_ as P}from"./AppLayout-BV7HVWRJ.js";import{u as Q}from"./useTranslations-C4Y-NByF.js";import"./ApplicationLogo-DwcnZXn5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-C30LA8Zs.js";const G={class:"text-xl font-semibold text-gray-900 dark:text-white"},J={class:"py-6"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},X={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},Z={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},I={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ee={class:"flex flex-wrap gap-2 mb-3"},te=["onClick"],se={class:"flex flex-wrap gap-2 mb-3"},ae=["onClick"],re=["onClick"],oe={class:"grid grid-cols-2 gap-4"},de={class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},le={class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},ie={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ne={class:"space-y-2"},ce=["value"],ue={class:"ml-3 text-sm text-gray-700 dark:text-gray-300"},_e={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ge={class:"space-y-3"},xe={class:"flex items-center"},fe={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},me={class:"flex items-center"},ye={class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},ve={key:0,class:"rounded-lg bg-gray-50 dark:bg-gray-700 p-4"},pe={class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},be={key:0,class:"flex items-center justify-center py-4"},he={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},ke={key:1,class:"text-sm text-red-600 dark:text-red-400"},we={key:2,class:"space-y-2"},Ce={class:"flex justify-between text-sm"},$e={class:"text-gray-600 dark:text-gray-400"},ze={class:"font-medium text-gray-900 dark:text-white"},Me={key:0,class:"flex justify-between text-sm"},je={class:"text-gray-600 dark:text-gray-400"},Ve={class:"font-medium text-gray-900 dark:text-white"},Be={class:"flex justify-between text-sm pt-2 border-t border-gray-200 dark:border-gray-600"},Se={class:"text-gray-600 dark:text-gray-400"},qe={class:"font-medium text-gray-900 dark:text-white"},Ye={class:"flex justify-between text-sm"},De={class:"text-gray-600 dark:text-gray-400"},Ee={class:"font-medium text-gray-900 dark:text-white"},Fe={class:"flex justify-between text-sm"},Ne={class:"text-gray-600 dark:text-gray-400"},Ue={class:"font-medium text-gray-900 dark:text-white"},Ae={class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600"},Le={key:0,class:"flex items-center text-sm text-green-600 dark:text-green-400"},Te={key:1,class:"text-sm text-amber-600 dark:text-amber-400"},He={class:"flex items-center"},Re={key:0,class:"mt-1 ml-5 list-disc text-xs"},Oe={key:0},Pe={class:"flex justify-end"},Qe=["disabled"],Ge={key:0},Je={key:1},Ke={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},We={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},Xe={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ze={key:1,class:"space-y-3"},Ie={class:"flex-1 min-w-0"},et={class:"flex items-center gap-2"},tt={class:"text-sm font-medium text-gray-900 dark:text-white"},st={class:"mt-1 flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"},at={key:0},rt={key:0,class:"mt-1 text-xs text-amber-600 dark:text-amber-400"},ot={class:"flex items-center gap-2 ml-4"},dt=["onClick","title"],lt=["onClick","title"],it={class:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},nt={class:"flex"},ct={class:"ml-3"},ut={class:"text-sm font-medium text-blue-800 dark:text-blue-300"},_t={class:"mt-1 text-sm text-blue-700 dark:text-blue-400"},pt={__name:"Audit",props:{exports:Array,years:Array,formats:Object,defaultYear:Number},setup(_){const{t:r}=Q(),k=_,o=A({period_start:`${k.defaultYear}-01-01`,period_end:`${k.defaultYear}-12-31`,format:"csv",include_credit_notes:!0,anonymize:!1}),c=h(null),p=h(!1),m=h(null),B=async()=>{p.value=!0,m.value=null;try{const d=await fetch(route("exports.audit.preview",{period_start:o.period_start,period_end:o.period_end,include_credit_notes:o.include_credit_notes}));if(!d.ok)throw new Error(r("faia.preview_error"));c.value=await d.json()}catch(d){m.value=d.message,c.value=null}finally{p.value=!1}};L([()=>o.period_start,()=>o.period_end,()=>o.include_credit_notes],()=>{o.period_start&&o.period_end&&B()},{immediate:!0});const S=d=>{o.period_start=`${d}-01-01`,o.period_end=`${d}-12-31`},q=(d,n)=>{const y=(n-1)*3+1,a=y+2,u=new Date(d,a,0).getDate();o.period_start=`${d}-${String(y).padStart(2,"0")}-01`,o.period_end=`${d}-${String(a).padStart(2,"0")}-${u}`},Y=(d,n)=>{n===1?(o.period_start=`${d}-01-01`,o.period_end=`${d}-06-30`):(o.period_start=`${d}-07-01`,o.period_end=`${d}-12-31`)},b=d=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(d),D=d=>d?new Date(d).toLocaleString("fr-FR"):"-",E=()=>{o.post(route("exports.audit.store"))},F=d=>{window.location.href=route("exports.audit.download",d.id)},N=d=>{confirm(r("faia.delete_confirm"))&&O.delete(route("exports.audit.destroy",d.id))},w=d=>{switch(d){case"completed":return{class:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",text:r("faia.status_completed")};case"processing":return{class:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",text:r("faia.status_processing")};case"failed":return{class:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",text:r("faia.status_failed")};default:return{class:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",text:r("faia.status_pending")}}};return(d,n)=>(i(),l(x,null,[C(t(T),{title:t(r)("faia_audit_export")},null,8,["title"]),C(P,null,{header:$(()=>[e("h1",G,s(t(r)("faia_audit_export")),1)]),default:$(()=>{var y;return[e("div",J,[e("div",K,[e("div",W,[e("div",X,[e("h2",Z,s(t(r)("faia.new_export")),1),e("form",{onSubmit:H(E,["prevent"]),class:"space-y-6"},[e("div",null,[e("label",I,s(t(r)("faia.period")),1),e("div",ee,[(i(!0),l(x,null,f(_.years,a=>(i(),l("button",{key:a,type:"button",onClick:u=>S(a),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"},s(a),9,te))),128))]),e("div",se,[(i(),l(x,null,f([1,2,3,4],a=>e("button",{key:`q${a}`,type:"button",onClick:u=>q(_.defaultYear,a),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}," T"+s(a)+" "+s(_.defaultYear),9,ae)),64)),(i(),l(x,null,f([1,2],a=>e("button",{key:`s${a}`,type:"button",onClick:u=>Y(_.defaultYear,a),class:"px-3 py-1 text-sm rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"}," S"+s(a)+" "+s(_.defaultYear),9,re)),64))]),e("div",oe,[e("div",null,[e("label",de,s(t(r)("faia.from")),1),v(e("input",{"onUpdate:modelValue":n[0]||(n[0]=a=>t(o).period_start=a),type:"date",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[z,t(o).period_start]])]),e("div",null,[e("label",le,s(t(r)("faia.to")),1),v(e("input",{"onUpdate:modelValue":n[1]||(n[1]=a=>t(o).period_end=a),type:"date",class:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-violet-500 focus:ring-violet-500"},null,512),[[z,t(o).period_end]])])])]),e("div",null,[e("label",ie,s(t(r)("faia.format")),1),e("div",ne,[(i(!0),l(x,null,f(_.formats,(a,u)=>(i(),l("label",{key:u,class:M(["flex items-center p-3 border rounded-lg cursor-pointer transition-colors",t(o).format===u?"border-violet-500 bg-violet-50 dark:bg-violet-900/20":"border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"])},[v(e("input",{"onUpdate:modelValue":n[2]||(n[2]=U=>t(o).format=U),value:u,type:"radio",class:"h-4 w-4 text-violet-600 focus:ring-violet-500"},null,8,ce),[[R,t(o).format]]),e("span",ue,s(a),1)],2))),128))])]),e("div",null,[e("label",_e,s(t(r)("faia.options")),1),e("div",ge,[e("label",xe,[v(e("input",{"onUpdate:modelValue":n[3]||(n[3]=a=>t(o).include_credit_notes=a),type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,512),[[j,t(o).include_credit_notes]]),e("span",fe,s(t(r)("faia.include_credit_notes")),1)]),e("label",me,[v(e("input",{"onUpdate:modelValue":n[4]||(n[4]=a=>t(o).anonymize=a),type:"checkbox",class:"h-4 w-4 rounded text-violet-600 focus:ring-violet-500 border-gray-300 dark:border-gray-600"},null,512),[[j,t(o).anonymize]]),e("span",ye,s(t(r)("faia.anonymize_data")),1)])])]),c.value||p.value||m.value?(i(),l("div",ve,[e("h3",pe,s(t(r)("faia.preview")),1),p.value?(i(),l("div",be,[n[5]||(n[5]=e("svg",{class:"animate-spin h-5 w-5 text-violet-500",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e("span",he,s(t(r)("faia.loading")),1)])):m.value?(i(),l("div",ke,s(m.value),1)):c.value?(i(),l("div",we,[e("div",Ce,[e("span",$e,s(t(r)("faia.invoices")),1),e("span",ze,s(c.value.invoices_count),1)]),t(o).include_credit_notes?(i(),l("div",Me,[e("span",je,s(t(r)("faia.credit_notes")),1),e("span",Ve,s(c.value.credit_notes_count),1)])):g("",!0),e("div",Be,[e("span",Se,s(t(r)("faia.total_ht")),1),e("span",qe,s(b(c.value.total_ht)),1)]),e("div",Ye,[e("span",De,s(t(r)("faia.total_vat")),1),e("span",Ee,s(b(c.value.total_vat)),1)]),e("div",Fe,[e("span",Ne,s(t(r)("faia.total_ttc")),1),e("span",Ue,s(b(c.value.total_ttc)),1)]),e("div",Ae,[c.value.sequence_valid?(i(),l("div",Le,[n[6]||(n[6]=e("svg",{class:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),V(" "+s(t(r)("faia.sequence_ok")),1)])):(i(),l("div",Te,[e("div",He,[n[7]||(n[7]=e("svg",{class:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),V(" "+s(t(r)("faia.sequence_gaps")),1)]),(y=c.value.sequence_errors)!=null&&y.length?(i(),l("ul",Re,[(i(!0),l(x,null,f(c.value.sequence_errors.slice(0,5),a=>(i(),l("li",{key:a},s(a),1))),128)),c.value.sequence_errors.length>5?(i(),l("li",Oe,s(t(r)("faia.and_more",{count:c.value.sequence_errors.length-5})),1)):g("",!0)])):g("",!0)]))])])):g("",!0)])):g("",!0),e("div",Pe,[e("button",{type:"submit",disabled:t(o).processing||!c.value||c.value.invoices_count===0&&c.value.credit_notes_count===0,class:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"},[t(o).processing?(i(),l("span",Ge,s(t(r)("faia.generating")),1)):(i(),l("span",Je,s(t(r)("faia.generate_export")),1))],8,Qe)])],32)]),e("div",Ke,[e("h2",We,s(t(r)("faia.export_history")),1),_.exports.length===0?(i(),l("div",Xe,s(t(r)("faia.no_exports")),1)):(i(),l("div",Ze,[(i(!0),l(x,null,f(_.exports,a=>(i(),l("div",{key:a.id,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",Ie,[e("div",et,[e("span",tt,s(a.period_label),1),e("span",{class:M(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",w(a.status).class])},s(w(a.status).text),3)]),e("div",st,[e("span",null,s(a.format_label),1),a.documents_count?(i(),l("span",at,s(a.documents_count)+" "+s(t(r)("faia.docs")),1)):g("",!0),e("span",null,s(D(a.created_at)),1)]),a.sequence_valid?g("",!0):(i(),l("div",rt,s(t(r)("faia.sequence_incomplete")),1))]),e("div",ot,[a.status==="completed"?(i(),l("button",{key:0,onClick:u=>F(a),class:"p-2 text-violet-600 hover:bg-violet-100 dark:hover:bg-violet-900/30 rounded-lg",title:t(r)("download")},[...n[8]||(n[8]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,dt)):g("",!0),e("button",{onClick:u=>N(a),class:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",title:t(r)("delete")},[...n[9]||(n[9]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,lt)])]))),128))]))])]),e("div",it,[e("div",nt,[n[10]||(n[10]=e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",ct,[e("h3",ut,s(t(r)("faia.about_faia")),1),e("p",_t,s(t(r)("faia.faia_description")),1)])])])])])]}),_:1})],64))}};export{pt as default};
