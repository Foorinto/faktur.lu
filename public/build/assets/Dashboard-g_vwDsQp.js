import{r as v,m as O,c as n,a as M,b as o,h as z,i as F,d as t,t as l,f as p,o as d,F as y,j as E,k as q,v as G,e as w,g as C,n as H,l as I,p as R,q as K}from"./app-zFpXp4fG.js";import{_ as X}from"./AccountantLayout-Bz5F4wsH.js";import{u as Z}from"./useTranslations-C21gh8T9.js";const tt={class:"mb-6"},et={class:"text-2xl font-bold text-slate-900 dark:text-white"},st={class:"mt-1 text-sm text-slate-500 dark:text-slate-400"},lt={class:"bg-white dark:bg-slate-800 rounded-2xl shadow p-4 mb-6"},ot={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},at={class:"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1"},rt=["value"],nt={class:"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1"},dt=["value"],it={class:"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1"},ut=["value"],ct={class:"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1"},vt=["placeholder"],mt={key:0,class:"bg-violet-50 dark:bg-violet-900/20 border border-violet-200 dark:border-violet-800 rounded-2xl p-4 mb-4 flex flex-wrap items-center justify-between gap-3"},xt={class:"text-sm font-medium text-violet-700 dark:text-violet-300"},ht={class:"flex gap-3"},pt=["disabled"],bt=["disabled"],_t={key:1,class:"text-center py-12"},kt={class:"mt-2 text-sm font-medium text-slate-900 dark:text-white"},ft={class:"mt-1 text-sm text-slate-500 dark:text-slate-400"},gt={key:2,class:"overflow-hidden rounded-2xl bg-white shadow border border-slate-200 dark:bg-slate-800 dark:border-slate-700"},yt={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},wt={class:"bg-slate-50 dark:bg-slate-700/50"},Ct={class:"py-3.5 pl-4 pr-2 w-10"},Vt={class:"hidden lg:table-cell px-3 py-3.5 text-right text-sm font-semibold text-slate-900 dark:text-white"},Tt={class:"px-3 py-3.5 text-center text-sm font-semibold text-slate-900 dark:text-white"},St={class:"hidden md:table-cell px-3 py-3.5 text-left text-sm font-semibold text-slate-900 dark:text-white"},jt={class:"divide-y divide-slate-100 dark:divide-slate-700"},Mt={class:"py-4 pl-4 pr-2"},Et=["value"],At={class:"px-3 py-4"},Ft={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},qt={class:"hidden lg:table-cell px-3 py-4 text-right text-sm text-slate-700 dark:text-slate-300"},Bt={class:"px-3 py-4 text-center text-sm text-slate-700 dark:text-slate-300"},Ut={key:0,class:"text-xs text-pink-500 ml-1"},Lt={class:"hidden md:table-cell px-3 py-4 text-sm text-slate-500 dark:text-slate-400"},Dt={class:"py-4 pl-3 pr-4 text-right sm:pr-6"},Nt={class:"flex items-center justify-end gap-2"},Ot=["onClick","title"],Ht={key:0,class:"bg-slate-50 dark:bg-slate-700/50"},It={class:"px-3 py-3 text-sm font-semibold text-slate-900 dark:text-white"},Rt={class:"hidden lg:table-cell px-3 py-3 text-right text-sm font-semibold text-slate-900 dark:text-white"},Jt={class:"px-3 py-3 text-center text-sm font-semibold text-slate-900 dark:text-white"},Pt={key:0,class:"text-xs text-pink-500 ml-1"},$t={__name:"Dashboard",props:{accountant:Object,clients:Array,filters:Object,years:Array,formats:Array},setup(b){const{t:a}=Z(),_=b,m=v(_.filters.year||new Date().getFullYear()),u=v(_.filters.quarter||null),k=v(_.filters.search||""),V=v("faia"),i=v([]),f=v(!1),T=v(!1),S=v(!1),J=[{value:null,label:a("full_year")},{value:1,label:"T1 (Jan-Mar)"},{value:2,label:"T2 (Avr-Jun)"},{value:3,label:"T3 (Jul-Sep)"},{value:4,label:"T4 (Oct-DÃ©c)"}],x=R(()=>{if(!k.value)return _.clients;const r=k.value.toLowerCase();return _.clients.filter(s=>s.name.toLowerCase().includes(r)||s.vat_number&&s.vat_number.toLowerCase().includes(r))}),P=()=>{f.value?i.value=x.value.map(r=>r.id):i.value=[]};O(i,r=>{f.value=r.length===x.value.length&&r.length>0});const B=()=>{i.value=[],f.value=!1,K.get(route("accountant.dashboard"),{year:m.value,quarter:u.value||void 0,search:k.value||void 0},{preserveState:!0,replace:!0})};let U;const Q=()=>{clearTimeout(U),U=setTimeout(()=>{B()},300)};O([m,u],B);const L=r=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(r||0),j=R(()=>{const r=x.value;return{ca_ht:r.reduce((s,e)=>s+(e.ca_ht||0),0),invoices_count:r.reduce((s,e)=>s+(e.invoices_count||0),0),credit_notes_count:r.reduce((s,e)=>s+(e.credit_notes_count||0),0)}}),W=()=>{i.value.length!==0&&(T.value=!0,D(route("accountant.mass-export"),{"client_ids[]":i.value,format:V.value,year:m.value,quarter:u.value||""}),setTimeout(()=>{T.value=!1},3e3))},Y=()=>{i.value.length!==0&&(S.value=!0,D(route("accountant.consolidated-report"),{"client_ids[]":i.value,year:m.value,quarter:u.value||""}),setTimeout(()=>{S.value=!1},3e3))},D=(r,s)=>{const e=document.createElement("form");e.method="POST",e.action=r,e.style.display="none";const c=document.createElement("input");c.name="_token",c.value=document.querySelector('meta[name="csrf-token"]').content,e.appendChild(c),Object.entries(s).forEach(([N,h])=>{if(Array.isArray(h))h.forEach(g=>{const A=document.createElement("input");A.name=N,A.value=g,e.appendChild(A)});else if(h!==""&&h!==null&&h!==void 0){const g=document.createElement("input");g.name=N,g.value=h,e.appendChild(g)}}),document.body.appendChild(e),e.submit(),document.body.removeChild(e)},$=r=>{const s=new URLSearchParams({year:m.value});u.value&&s.append("quarter",u.value);const e=V.value;if(e.startsWith("accounting_")){const c=e.replace("accounting_","");window.location.href=route("accountant.accounting-export",{user:r,format:c})+"?"+s.toString()}else window.location.href=route("accountant.export",{user:r,type:e})+"?"+s.toString()};return(r,s)=>(d(),n(y,null,[M(o(z),{title:o(a)("my_clients")},null,8,["title"]),M(X,{accountant:b.accountant},{default:F(()=>[t("div",tt,[t("h1",et,l(o(a)("my_clients")),1),t("p",st,l(o(a)("manage_export_clients")),1)]),t("div",lt,[t("div",ot,[t("div",null,[t("label",at,l(o(a)("year")),1),p(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm"},[(d(!0),n(y,null,E(b.years,e=>(d(),n("option",{key:e,value:e},l(e),9,rt))),128))],512),[[q,m.value]])]),t("div",null,[t("label",nt,l(o(a)("quarter")),1),p(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>u.value=e),class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm"},[(d(),n(y,null,E(J,e=>t("option",{key:e.value,value:e.value},l(e.label),9,dt)),64))],512),[[q,u.value]])]),t("div",null,[t("label",it,l(o(a)("format")),1),p(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>V.value=e),class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm"},[(d(!0),n(y,null,E(b.formats,e=>(d(),n("option",{key:e.value,value:e.value},l(e.label),9,ut))),128))],512),[[q,V.value]])]),t("div",null,[t("label",ct,l(o(a)("search_client")),1),p(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>k.value=e),onInput:Q,type:"text",placeholder:o(a)("search_client")+"...",class:"block w-full rounded-xl border-slate-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-sm"},null,40,vt),[[G,k.value]])])])]),i.value.length>0?(d(),n("div",mt,[t("span",xt,l(i.value.length)+" "+l(o(a)("clients_selected")),1),t("div",ht,[t("button",{onClick:W,disabled:T.value,class:"inline-flex items-center px-4 py-2 rounded-xl text-sm font-medium text-white bg-violet-600 hover:bg-violet-500 disabled:opacity-50 transition-colors"},[s[6]||(s[6]=t("svg",{class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),w(" "+l(T.value?o(a)("exporting")+"...":o(a)("export_selection")),1)],8,pt),t("button",{onClick:Y,disabled:S.value,class:"inline-flex items-center px-4 py-2 rounded-xl text-sm font-medium text-violet-700 bg-white border border-violet-300 hover:bg-violet-50 dark:bg-slate-800 dark:text-violet-300 dark:border-violet-600 dark:hover:bg-slate-700 disabled:opacity-50 transition-colors"},[s[7]||(s[7]=t("svg",{class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),w(" "+l(S.value?o(a)("generating_report")+"...":o(a)("consolidated_report")),1)],8,bt)])])):C("",!0),b.clients.length===0?(d(),n("div",_t,[s[8]||(s[8]=t("svg",{class:"mx-auto h-12 w-12 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),t("h3",kt,l(o(a)("no_clients_yet")),1),t("p",ft,l(o(a)("no_clients_yet_description")),1)])):(d(),n("div",gt,[t("table",yt,[t("thead",wt,[t("tr",null,[t("th",Ct,[p(t("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=e=>f.value=e),onChange:P,class:"rounded border-slate-300 text-violet-600 focus:ring-violet-500 dark:border-slate-500 dark:bg-slate-600"},null,544),[[H,f.value]])]),s[9]||(s[9]=t("th",{class:"px-3 py-3.5 text-left text-sm font-semibold text-slate-900 dark:text-white"},"Client",-1)),t("th",Vt,l(o(a)("ca_ht")),1),t("th",Tt,l(o(a)("invoices")),1),t("th",St,l(o(a)("last_export")),1),s[10]||(s[10]=t("th",{class:"relative py-3.5 pl-3 pr-4 sm:pr-6"},[t("span",{class:"sr-only"},"Actions")],-1))])]),t("tbody",jt,[(d(!0),n(y,null,E(x.value,e=>(d(),n("tr",{key:e.id,class:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors"},[t("td",Mt,[p(t("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":s[5]||(s[5]=c=>i.value=c),class:"rounded border-slate-300 text-violet-600 focus:ring-violet-500 dark:border-slate-500 dark:bg-slate-600"},null,8,Et),[[H,i.value]])]),t("td",At,[M(o(I),{href:r.route("accountant.client",e.id),class:"font-medium text-slate-900 dark:text-white hover:text-violet-600 dark:hover:text-violet-400 transition-colors"},{default:F(()=>[w(l(e.name),1)]),_:2},1032,["href"]),e.vat_number?(d(),n("p",Ft,l(e.vat_number),1)):C("",!0)]),t("td",qt,l(L(e.ca_ht)),1),t("td",Bt,[w(l(e.invoices_count)+" ",1),e.credit_notes_count>0?(d(),n("span",Ut," ("+l(e.credit_notes_count)+" "+l(o(a)("credit_notes_short"))+") ",1)):C("",!0)]),t("td",Lt,l(e.last_export_at||"-"),1),t("td",Dt,[t("div",Nt,[t("button",{onClick:c=>$(e.id),class:"p-1.5 rounded-lg text-slate-400 hover:text-violet-600 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",title:o(a)("export_selection")},[...s[11]||(s[11]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Ot),M(o(I),{href:r.route("accountant.client",e.id),class:"p-1.5 rounded-lg text-slate-400 hover:text-violet-600 hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",title:o(a)("details")},{default:F(()=>[...s[12]||(s[12]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1},8,["href","title"])])])]))),128))]),x.value.length>1?(d(),n("tfoot",Ht,[t("tr",null,[s[13]||(s[13]=t("td",{class:"py-3 pl-4 pr-2"},null,-1)),t("td",It," Total ("+l(x.value.length)+" clients) ",1),t("td",Rt,l(L(j.value.ca_ht)),1),t("td",Jt,[w(l(j.value.invoices_count)+" ",1),j.value.credit_notes_count>0?(d(),n("span",Pt," ("+l(j.value.credit_notes_count)+" "+l(o(a)("credit_notes_short"))+") ",1)):C("",!0)]),s[14]||(s[14]=t("td",{class:"hidden md:table-cell px-3 py-3"},null,-1)),s[15]||(s[15]=t("td",{class:"py-3 pl-3 pr-4 sm:pr-6"},null,-1))])])):C("",!0)])]))]),_:1},8,["accountant"])],64))}};export{$t as default};
